 %Report on The Design of a White Lab Component Vending Machine
%Undergratuate Engineering Thesis
%Author: Baden David Morgan
%Supervisor: Justin Pead

%document formatting
\documentclass[a4paper,11pt]{article}

	% packages
\usepackage{graphicx}
\graphicspath{{C:/"Google Drive"/thesis/Document/Pictures/}}
\usepackage[margin=2cm]{geometry}

\usepackage[hidelinks]{hyperref}
\newcommand*{\fullref}[1]{\hyperref[{#1}]{\Appendixautorefname  \ref*{#1} \nameref*{#1}}}
\newcommand*{\halfref}[1]{\hyperref[{#1}]{\autoref*{#1}}}
\newcommand*{\Appendixautorefname}{Appendix }

\usepackage{amsmath}
\numberwithin{figure}{section}
\numberwithin{table}{section}

\usepackage[pagestyles]{titlesec}
%title formatting
\titleformat*{\section}{\center\Huge\bfseries}
%\titleformat*{\subsection}{\LARGE\bfseries}
\titleformat{\subsection}[block]{\LARGE\bfseries\hspace{1em}}{\thesubsection}{1em}{}
\titleformat{\subsubsection}[block]{\Large\bfseries\hspace{2em}}{\thesubsubsection}{1em}{}
\titleformat*{\paragraph}{\large\bfseries}
\titleformat*{\subparagraph}{\large\bfseries}

\setlength{\parindent}{0em}
\setlength{\parskip}{1em}

\usepackage{nomencl}
\makenomenclature

\usepackage[title]{appendix}

\usepackage{pdflscape}

\usepackage{notoccite}

\usepackage{textcomp}
\usepackage{gensymb}

\usepackage{tabularx}
\usepackage{eurosym}

\def\changemargin#1#2{\list{}{\rightmargin#2\leftmargin#1}\item[]}
\let\endchangemargin=\endlist 

%\usepackage{tocloft}
%\setlength{\cftfignumwidth}{2.55em}

\makeatletter
\def\l@figure{\@dottedtocline{1}{1.5em}{3em}}
\makeatother

\usepackage{color}

\usepackage{listings} %For code in appendix

\usepackage{placeins}

\newpagestyle{mypage}{%
  \sethead{\MakeUppercase{\sectiontitle}}{}{\MakeUppercase{\thesubsection\quad \subsectiontitle}}
  \setfoot{}{\thepage}{} 
}

\newpagestyle{indexing}{%
  \sethead{\MakeUppercase{\sectiontitle}}{}{}
  \setfoot{}{\thepage}{} 
}

\newpagestyle{sectionstart}{%
  \setfoot{}{\thepage}{} 
}

%\usepackage{fancyhdr}
%\renewcommand{\subsubsectionmark}[1]{\markright{\MakeUppercase{\thesubsubsection\ #1}}}
%\pagestyle{fancy}
%\fancyhf{}
%\fancyhead[R]{\rightmark}
%\cfoot{\thepage}
%\fancyhead[R]{\thepage}
%

\usepackage{url}

\usepackage{xcolor}

\usepackage{enumitem}


\hyphenpenalty 10000
\exhyphenpenalty 10000

\begin{document}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	% title page
\begin{titlepage}
	\centering
	\setlength{\parskip}{0em}
	{\Huge\bfseries\underline{Design of a White Lab}\par}
	{\Huge\bfseries\underline{Component Vending Machine}\par}
	\vspace{5mm}
	{\huge Design and Build Report of a Component Vending Machine for the Undergraduates of White 	Lab\par}
	\vspace{5mm}
	\includegraphics[scale=0.2]{{UCTLogo}.jpg}
	
	\vfill
	Prepared by:\par
	Baden David Morgan\par
	MRGBAD001\par
	
	\vfill
	Prepared for:\par
	Mr. J. Pead\par
	Department of Electrical and Electronics Engineering\par
	University of Cape Town\par
	
	\vfill
	Submitted to the Department of Electrical Engineering at the University of Cape Town
	in partial fulfilment of the academic requirements for a Bachelor of Science degree in
	Mechatronic Engineering\par
	
	\vfill
	{\large November 14, 2016 \par}
	
	\vfill
	{\bfseries Key words:}
	Vending Machine, Embedded Systems, Web Design, Circuit Design, Design Report, Build Report, C, Python, PHP, HTML, MySQL, Mechatronics
\end{titlepage}

	% empty page
	%\mbox{}
	%\thispagestyle{empty}
	%\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	% plagiarism declaration
	\thispagestyle{empty}
	
	\begin{figure}[ht]
	\centering	
	\includegraphics[scale=4.45]{{plagiarismdec}.jpg}
	\end{figure}
	%{\huge Plagiarism Declaration \par}
	%\begin{enumerate}
  		%\item I, Baden David Morgan, know that plagiarism is wrong. Plagiarism is to use another's work and pretend	that it is one's own.
 		%\item I, Baden David Morgan, have used the IEEE convention for citation and referencing. Each contribution to, and quotation in this report from the work, or works, of other people has been attributed and has been cited and referenced.
 		%\item This report is my, Baden David Morgan's, own work.
 		%\item I, Baden David Morgan, have not allowed, and will not allow, anyone to copy my work with the intention of passing it off as their own work or part thereof.
	%\end{enumerate}
		%\noindent\begin{tabular}{ll}
		%Full Name: & Date:\\% adds space between the two sets of signatures
		%Baden David Morgan & November 14, 2016\\[8ex]
		
		%\makebox[2.5in]{\hrulefill} \\
		%Signature \\[8ex]% adds space between the two sets of signatures
	%\end{tabular}
	\newpage
	
	% empty page
	%\mbox{}
	%\thispagestyle{empty}
	%\newpage	
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	%terms of reference
	\pagenumbering{roman}	
	
	{\centering\Huge\bfseries\underline{Terms of Reference}\par}
	{\Large\bfseries{Title:}\par}
	Design of a White Lab Component Vending Machine.\par
	{\Large\bfseries{Description:}\par}
	The UCT component store cannot stay open 24/7 however students would
appreciate if they could get access to components on request. Most student requests can be solved by providing a small subset of components. A modular machine may be a solution to late night component queries.\par
	{\Large\bfseries{Deliverables:}\par}
	{\begin{itemize}
	\item Mechanical Design of a component Dispenser for different sizes.
	\item Electronics capable of counting, logging and dispenses components.
	\item Create it in a modular fashion to be extendable as student
requirements increase.
	\end{itemize}}
	{\Large\bfseries{Skills/Requirements:}\par}
	Some Mechanical Design, Electronics, Embedded Systems.\par
	{\Large\bfseries{Area:}\par}
	Electronics / Embedded Systems.\par
	\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	%acknowledgements
	{\centering\Huge\bfseries\underline{Acknowledgments}\par}
	Throughout this project I was given the opportunity to work on topics I had never delved into before. I was also able to exercise and improve my skills as a practical engineer. This project would not have been possible without help from many of the people I know.
	
	Firstly I like to thank Jason Russel for helping me with some of my knowledge lacking on web development. He helped me make the website functional allowing me to prove that this project could work as an internet connected device.
	
	I would like to thank Brandon Piner for the help he gave me throughout this project. Whether it be him just listening to me for hours and letting me bounce ideas off him, or helping me debug my circuit boards and staying till we found the problem. He has been such a big help as a friend throughout the years and I greatly appreciate the help he has given me for this project and more so, his friendship.
	
	James Roberston my boss deserves a mention as he was the first person I ever worked for. The experience I gained working for him and the opportunity he gave me helped me realize that I was capable of being an engineer, giving me confidence in the work I did even when I didn't. I will always be grateful for the opportunity he gave me.
	
	Berdine Smit who I would like to thank for helping with some of the proof reading of my document. %She was a great help in finding small errors my parents and I were not able to pick up.
	
	Phillip Titus, Riyadh Jacobs and Masonwabe Nomaya for the extensive help they provided during the assembly of the enclosure. Without their help The enclosure would not have been in its current state and I greatly appreciate their help and guidance. I would also like to specially thank them for helping me when access to campus was limited and they were still willing to help me. If not for this I would not have been able to complete the enclosure in time.
	
	I would also like to thank Brendon Daniels for the many components he has supplied and the help he has given me over the course of this project.
	
	Second to last I would like to thank Justin Pead my supervisor. The guidance he has provided has been more than pivotal to the success of this project, the success I feel I may not have been achieved had he not been my supervisor. Also over my years at UCT he has helped me with multiple projects and o9i8 very easy to approach when I have had a question. I would also like to thank Justin for treating me more like a peer than a student giving me confidence in what I was doing. This projects success is shared with and accredited to him.

	Finally I would like to thank my family. My brother over the years who has been like a best friend to me. "You can choose your friends but you can't choose your family. And I do choose you as a friend" a quote he made at his 21st that I will always remember. His friendship and support has been the most valuable friendship to me over the 23 years I have been alive and I will never take it for granted. And most importantly I would like to thank my parents, without whom my achievements would not have been possible. They have supported me financially for the entirety of my academic career and I can't even begin to thank them enough for this. They have supported me 100\% of the way. Including helping with proof reading this report. I could not have asked for more loving and caring parents. To all the support and love they have given me over the many years I thank them the most.
	\newpage
	
	% empty page
	%\mbox{}
	%\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	%abstract
	{\centering\Huge\bfseries\underline{Abstract}\par}

The White Lab is a hub for the UCT undergraduates where they can study and work on their projects and assignments. Certain services are supplied for them in order to assist them. One of these services has been the White Lab Component store which operates during the day. This store allowed students to acquire components during the day. However, they have no option to acquire components at night. The White Lab Component Vending Machine would be designed to solve this problem.

The research began by reviewing work similar to that of this research. The similar work focused on medication dispensers and one component dispenser. Four articles in total were reviewed, in order to gain an understanding of the mechanical methods used to draw inspiration for the designs of this report. Reviews into the topics pertaining to aspects of the research were conducted, for example, the communication standards required and the RFID module to be used for the Component Vending Machine.

Multiple design aspects were approached for the Component Vending Machine to enable a ground up design that could facilitate the White Lab Component Vending Machine. Delivery mechanisms were designed to dispense DIP package components and DIP IC holders. A PCB, called the MCU module, was designed in order to control the delivery mechanism. A PCB was designed in order to interface with a Raspberry Pi and enable it to control the MCU modules and connect to a PSU. An enclosure was designed that would be able to fit all the delivery mechanisms and electronics that made up the Component Vending Machine. Additional designs were done for aesthetics, to enable the Component Vending Machine to be user friendly.

A LAMP server and a custom website were installed on the Raspberry Pi that would enable students to order components online, before collecting them at the Component Vending Machine. The components could be collected by swiping their student card. The enclosure was assembled by welding the frame and bolting the panels onto the aforementioned frame. The drop plate was bent and attached to the enclosure. Six delivery mechanisms were built, one for each specific design in this report. Six MCU modules were assembled and connected to a delivery mechanism. The PCB which was to interface with the Raspberry Pi, was assembled. Finally, all the assembled pieces were installed in the enclosure and connected enabling them to communicate with one another.

Tests were done in order to make sure the Component Vending Machine was reliable enough to meet the requirements. Upon testing, it was found that delivery mechanisms exceeded expectations and the reliability requirements. It was found that the Component Vending Machine was also able to communicate with a website as designed, for online orders and able to reliably dispense orders made on the online store.

Although the Component Vending Machine was a success, improvements have been recommended. The enclosure frame was not rigid enough and needed to be strengthened. The RFID antenna had a poor range combined with the aliminium panel absorbing the signal made the RFID reader unreliable. A redesign of the RFID cover system would be needed to make it more reliable. Due to the scope of the project, the variety of the Component Vending Machine was limited to DIP packages. Further research should be done to increase the range of components the Component Vending Machine can dispense. It is recommended that this research project be continued because it proved to be successful.
	
	\newpage	
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	% insert the table of contents
	\tableofcontents
	\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	% list of figures here
	\listoffigures
	\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 	%list of tables here
	\listoftables
	\newpage
	
	%nomanclature 
	\mbox{}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%nomenclature
	\printnomenclature[2cm]	
	
	\nomenclature{I2C}{Inter-integrated Circuit - A hardware level communications protocol using a clock.}
	\nomenclature{UART}{Universal Asynchronous Receiver/Transmitter - A hardware level communication protocol without a clock.}
	\nomenclature{RX}{Receiver Number x - Relates to the receive pin of a communications protocol, typically UART.}
	\nomenclature{TX}{Transmitter number x - Relates to the transmit pin of a communications protocol, typically UART.}
	\nomenclature{RFID}{Radio Frequency Identification - A protocol using near field communications technology.} 
	\nomenclature{URL}{Uniform Resource Locator - A name relating to a address on the internet given by a DNS.}
	\nomenclature{HTTP}{Hypertext Transfer Protocol - The protocol used to communicate over the internet and make and receive requests.}
	\nomenclature{PHP}{Hypertext Preprocessor - A language used to help make dynamic content on websites.}
	\nomenclature{IP}{Internet Protocol - The protocol used to identify servers on the internet.}
	\nomenclature{HAT}{Hardware Attached onTop - A common name given to a piece of hardware that interfaces with a Raspberry Pi.}
	\nomenclature{PCB}{Printed Circuit Board - A board that has a conductive metal printed on it to make electronic products.}
	\nomenclature{HTML}{Hypertext Markup Language - The language used to generate static content on a website.}
	\nomenclature{API}{Application Programming Interface - A method used to create a system specific communications specification.}
	\nomenclature{ECE}{Electrical \& Computer Engineering - A type of engineering.}
	\nomenclature{PLA}{Polylactic Acid - A common plastic used in 3D printing.}
	\nomenclature{ABS}{Acrylonitrile Butadiene Styrene - A common plastic used in 3D printing.}
	\nomenclature{ADC}{Analog to Digital Converter - A hardware component that enables a digital device to be able to sample analog signals.}
	\nomenclature{MCU}{Microntroller Unit - A digital logic device that is programmable.}
	\nomenclature{IC}{Integrated Circuit - A circuit that was integrated into a small package, like the DIP package.}
	\nomenclature{DNS}{Domain Name System - A server type that enables a network to assign URL names to a specific IP.}
	\nomenclature{ASCII}{American Standard Code for Information Interchange - A standard set out to relate numbers to symbols and letters for using in computer science and engineering.}
	
	
	
	
		
	\newpage
	
	% new section
	\pagenumbering{arabic}
	\newpage
	\pagenumbering{arabic}
	\newpage
	
\hypersetup{%
  pdfborderstyle={/S/U/W 1}% border style will be underline of width 1pt
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\pagestyle{mypage}
	% introduction
\section{Introduction}\thispagestyle{sectionstart}
	%Well, and here begins my lovely report.
	\subsection{Subject and motivation for the Research}
The White Lab is a hub for the electrical engineering students of UCT to interact with one another and work on assignments and projects. The White Lab has many facilities to help students with these assignments and projects including supplies such as wiring, veroboard and components. The White Lab can be very busy during the day and at night. On a busy day, students can be seen lining up to collect components from the White Lab component store or be seen waiting for it to re-open. At night however, they do not have the luxury of the component store, besides a selection of resistors on the wall outside the component store. Not being able to acquire components from the White Lab component store during specific times can cause delays in students' assignments and projects, especially, overnight. The proposed solution to this problem is the White Lab Component Vending Machine. This Component Vending Machine would be operational 24 hours a day 7 days a week, with an online store for ordering components and the physical Component Vending Machine where students can collect components. 

The components to be dispensed are those most requested by students. A list of commonly ordered components was compiled, prior to the investigation of this report, by the head of the White Lab Component Store. The most common components observed from this list were seen to be in packages such as DIP and TO packages. This information was compiled by the Principal Technical Officer of White Lab, Justin Pead, and the manager of the White Lab Component Store, Brendon Daniels. These packages brought about the hypothesis that a mechanism for dispensing individual components could be designed to cater for specific packages. The need for lines at the component store would be reduced by introducing the Component Vending Machine and allow students to acquire components at night when the Component store would be closed. These component packages were universal, meaning a designs to cater for these packages could be a possible solution. It also meant that if a design for a package could be achieved, multiple different components could be dispensed.

This report documented the research, design, build process and assembly of the White lab Component Vending Machine. 
	\subsection{Objectives of this Research}
The main objectives of this report were to investigate the mechanical and software design of a Component Vending Machine. The Component Vending Machine needed to:
\begin{enumerate}
\item reliably dispense individual components on a regular basis.
\item be internet controllable for remote component ordering and control.
\item be self contained and user friendly.
\item stock components in a manner that they could be dispensed and restocked easily.
\end{enumerate}

		\subsubsection{Problems to be investigated}
The above mentioned basic requirements of the Component Vending Machine could be formalized and investigation problems formed, as listed below:
\begin{itemize}
\item \textbf{Internet Viability:} Investigate the possibility of connecting such a device to the internet and what software and hardware would be required. A test case would be examined and constructed to prove the possibility of an internet connected Component Vending Machine.
\item \textbf{Mechanical Delivery Mechanism:} One of the main focuses of this research was to investigate designs of previous projects. Once information on previous projects was acquired, a solution would be designed to meet the requirements for single component delivery mechanisms. These delivery mechanisms had be modular to promote expansion.
\item \textbf{Enclosure design:} An enclosure would be needed in order to house the delivery mechanism and stock of components. The enclosure had to be big enough to house the planned delivery mechanism to be built for this report and future delivery mechanism
\item \textbf{PCB and Circuit design:} PCBs were needed to control each delivery mechanism. This had to be designed to meet the specification of the designed delivery mechanism. Challenges that were to be investigated are communication due to a noisy environment and microcontroller selection and designing a circuit around it. The circuit had to accommodate a modular design for future expansion.
\item \textbf{Software requirements:} On top of the software needed to facilitate an online connection, software would be needed in order to control the delivery mechanisms and the Component Vending Machine itself. This required some embedded software design and software development. 
\item \textbf{Assembly:} The assembly of the Component Vending Machine would be documented in order to find problems and assess the viability of the design proposed in this report. Each element of the design would be addressed individually.
\end{itemize}
		\subsubsection{Purpose of this Research}
The purpose of this research and report was to assess the overall viability of a 24 hour Component Vending Machine and all the components that made it. The design and research was to help current and future UCT students by giving them an extra method of acquiring components in the White Lab and extending the times they may do so. It was intended that this design be an in place solution for this problem or a prototype that could be used to build a more commercial product. The Aim of this research was not to replace the White Lab Components Store, but rather an extension of it.
	\subsection{Scope and Limitations of the Research}
The scope of this project was defined only by the components supplied by the White Lab but was narrowed down, in order to focus on the overall objectives. This meant compromises needed to be made. The scope of the project defined that an entire Component Vending Machine be designed from the ground up. The scope of the internet connection was limited to a test case of specifically designed website to prove the viability of having the Component Vending Machine operate in conjunction with a web based store. The current component store stocks a plethora of components that student can request. It would not be viable nor effective to design for all cases, as not all components were requested as often as others. The scope of the design was limited to DIP package components, those being the most commonly requested components. This information was obtained from the current White Lab Component Store. It was intended that recommendations be given on other component packages but no implementations will be specifically discussed. 
	\subsection{Plan of Development}	
Initially, review and research was done on peers' work that was similar to the topic of this report. It was reviewed in order to gain insight into how they approached the problem and to find possible problems and ways to improve on their attempts. This was not to copy from their work, but to take inspiration from their work. Research into concepts and theories that would help gain an understanding on certain aspects of the research were reviewed next. This included reviews of the hardware and software to be used. These reviews are presented in the first section.

A breakdown of the system specifications was layed out in order to gain a better understanding of the research in the next section. Thereafter, a methodology was layed out in order to help understand how the research was approached. 

The component selection was presented after the methodology. The components for all the designs were selected and the reason for selecting the aforementioned components were reviewed and presented in the next section.

The next section covered the design of the research project. It covers the design of all the components that made up the research. This was done by presenting each version of the different designs that were made during the course of the research and explaining why they were discarded or used.

The following section will cover the assembly of the project the research is on. The assembly draws reference from the design to help explain how it was assembled. The assembly concludes with an overview and presentation of the final product.

The next section covers the testing that was done at various stages of the research. Each test is first presented then a discussion and remarks are made about the results of the tests.

The conclusion comes next, finalizing the design and giving a verdict on the research project based on the results from the previous section.

Finally, recommendations are presented for improvements that could be made to the research, design and assembly. The recommendations cover many issues and possible implementations all gained from experience throughout the course of the research.

Additionally, appendices are attached to give further insight into the research.
	\subsection{Note for Reader}
	If this document is being read on a computer or a digital device that supports the pdf format, take note that citations, cross-references and links are all clickable. This is to make navigating this report easier and more enjoyable to read on electronic devices.
	\newpage
\setlength{\parskip}{1em}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	% literature review
\section{Literature Review}\thispagestyle{sectionstart}
Investigations into work similar about the topic of this report i.e., dispensers of small objects, were done in order to gain more insight into the report and better understand how a design of this calibre should operate. The reviews were done so that similar mistakes could be mitigated and to possibly improve on existing ideas. A literature review of various works will be presented in this section. It will start with work and designs similar to that of this project. After similar work has been reviewed and presented, documentation and literature on fundamental aspects of the project will be reviewed. This is in order to gain specific insight into how to customize the design in order to adhere to the requirements of this project effectively. 

\subsection{Similar Work}
Similar work to the topic of this report will be presented in this section. It was difficult to find work specifically related, so for the most part, medical dispensers were considered a close comparison. This comparison was chosen as medication comes in a small package and can also be specific to each package, where one unit of medication was dispensed at a time. This drew parallels to the White Lab Component Vending Machine requirements and so work in this field was reviewed, but only the design aspects of these works.

The investigations started off by looking at multiple sources. The list of possible sources was narrowed down to 10 in total as those 10 were the most relevant to the research of this project. After further reading it was found that not all the sources were thorough enough or outdated. M3DITRACK3 \cite{CHELVAM2014240} was reviewed but later discarded as the design documented in the report was insufficient. The Multipurpose Robotic Dispenser \cite{6203052} was also discarded as its design report was insufficient. After a quick read of the smartphone-enhanced pill-dispenser \cite{7145252} report it was found that the main focus was on software and so this was also discarded. Additionally patents were looked at but were either out of date or better designs had already been reviewed. This lead to the four sources that were reviewed below.

\subsubsection{Portland State University Vending Machine}
At Portland State University under the ECE department, a vending machine was retrofitted to provide a wide range of components, 24/7. They employed a method of using zip lock bags and placing a package of components in each bag. These bags were then put in a standard snack vending machine like the ones commonly seen at stores and on campuses, like UCT. In order to restock the machine, volunteers packaged these bags with various components. A picture of what was inside the vending machine can be seen at \autoref{fig:port} \cite{PORTU,vend}.   

	\begin{figure}[ht]
	\centering
	\includegraphics[scale=0.2]{{PortVM}.jpg}
	\caption{The Portlands State University's component vending machine and how components were presented \cite{vend}.\label{fig:port}}
	\end{figure}

A major advantage of Portland State University's solution was that it was not component specific. Since a vending machine could have multiple racks with multiple rails on each rack, the capacity of components could be very large. Although this was a good solution to the problem and up scaling an old vending machine was a good use of resources, this solution has many drawbacks which are presented below. 

The loading solution was to have multiple volunteers put packages together and manually load each rail of the vending machine. This required multiple individuals input to reload a rail which could delay restocking the machine. Since packages were pre-packed, students do not have a choice of smaller quantities. Another issue was that it being a vending machine , even though it was a paid model, the access was not regulated . That meant that one person could empty a rail in one day f they chose to do so. Overall this was a good solution but a more targeted solution would be required for the UCT's Component Vending Machine.

\subsubsection{Medication Dispenser, University of Tasmania}
\label{subsec:med1}
A group from University of Tasmania \cite{med1} proposed a solution for medication dispensers that would be installed at a patients house. The device was to be connected to the internet and the dispensing action would be initiated by the physician overseeing the patient's whose home the device was in. \autoref{fig:med1} Illustrates how the device would operate mechanically.

	\begin{figure}[ht]
	\centering	
	\includegraphics[scale=0.2]{{med1}.jpg}
	\caption{Proposed design of medication dispenser from the group at UT \cite{med1}. \label{fig:med1}}	
	\end{figure}

The dispenser was fed by a gravity, spring assisted, magazine of medication, which was labelled ``vertical tube containing tablets" in \halfref{fig:med1}. Although having a gravity fed system allows for a larger number of tablets in the magazine, the spring hindered this capability. The spring would limit the number of tablets by the compression force of the spring i.e.; the force imparted on the units by the spring that would crush the tablets. It would also be limited by the size of the spring causing a further design choice not shown in the report; length of the spring vs the spring constant. Getting the spring constant and length right for this loading mechanism would greatly affect the reliability of the magazine feed and determine how many tablets would be able to fit into a single load of the magazine. 

A solenoid was placed at the bottom of the vertical tube to dispense the tablets and was actuated to dispense one tablet. The solenoid was actuated via an ``interface circuitry'' which in turn was controlled by a DAQ receiving commands via an internet connection. This was similar to the design requirements to the White Lab Component Vending Machine. A physician controlled when a tablet would be dispensed. One issue with the device was that it did not have any sensors depicted that would detect a jam or empty magazine. Although a camera was shown this was so that the physician could get visuals of the patient for whom the tablet was being dispensed to.

Although the device did not have any sensors for jamming or empty magazine detection, having it connected to the internet allowed for logging of the device to check it was operating reliably. The physician could keep track and moderate dosages as they saw fit. This seemed ideal in a medical application. However, this would not work for a component dispenser. A useful idea from this medication dispenser was using a gravity fed system allowing reduced moving parts and potentially greater stock, reducing the need for constant restocking. Having an internet connected device fell under the same requirements of the Component Vending Machine. The solution the University of Tasmania came up with was to compartmentalize the internet connection and the circuitry.  This compartmentalization idea between the internet connection and embedded electronics could be used in the Component Vending Machine. 

\subsubsection{Medication Dispenser, Narcotic Rehabilitation}
\label{subsec:med2}
The second medication dispenser reviewed was one intended for narcotic rehabilitation \cite{med2}. It had many features similar to those needed for the White Lab Component Vending Machine including single tablet dispensing and control via the internet.

	\begin{figure}[ht]
	\centering
	\includegraphics[scale=0.25]{{med2}.jpg}
	\caption{Dispensing mechanism for Medication dispenser for narcotic rehabilitation with cover removed \cite{med2}. \label{fig:med2}}
	\end{figure}
	
The medication dispenser started off with a few specifications ranging from a tamper-proof housing to remote control via the internet, those being related to the design of the Component Vending Machine. Depicted in  \halfref{fig:med2}, the mechanism was driven by a stepper-motor , (5), connected to a cylinder, (1), by a shaft at (8), with the dosages attached to the cylinder, (4). As the dosage rotated to the bottom position another stepper motor would engage a mechanical drive, (7), to push the dosage rod out as shown at (2) and retract the rod. Limit switches, at (9), were used to determine the position of the bottom rod and an optical sensor was used to determine the amount of rotation of the cylinder at (10). It measured the rotations by using a slotted disk and shining a light through the slots and counting the times the light was blocked and re-appeared. The mechanism would then be situated in a strong housing to prevent tampering, and if tampering did occur, it would be obvious due to damage needed to open the housing. This dispensary mechanism was controlled by a microcontroller communicating with a computer, which in turn, was connected to the internet. 

The cylinder provided a reliable delivery mechanism but limited the amount of stock of the tablets that could be loaded in the dispenser. This could be a design choice by the people who designed it as patients being rehabilitated should not have access to medication in large amounts even if it was protected. This reliable method of using a cylinder or a wheel could be advantageous as the design rotated with all its parts making it difficult for a jam to occur from clashing of parts. The only danger would be if the dispensary rod was extended and the cylinder rotated. This was avoided by using sensors to detect the extension of the rod. This rationale of preventing the device from causing damage to itself by effectively using sensors and programming should be implemented in the Component Vending Machine.

Another interesting approach used for the programming was the compartmentalization of tasks. The microcontroller acted on its own with all the programming to do a complete dispensary action if needed but, received commands to do so by a computer connected to the internet. This method made each individual device act reliably, like the microcontroller and the computer which enabled the system as a hole, to be more reliable. This kind of programming style should be used for the Component Vending Machine to make it work effectively.

\subsubsection{3D Adjustable cavity Medication Dispenser}
\label{subsec:med3}

The 3D adjustable cavity Medication Dispenser was aimed to solve a few problems observed in previous attempts by other parties. These problems were; the density of tablets stored in the mechanism, the variety of tablets and the adaptability of the mechanism. It aimed to do this with its 3D adjustable cavity solution, ``3DAC" for short \cite{med3}. The 3DAC system was also intended to be a home dispensary system meaning it had to be compact for a home space.
	
	\begin{figure}[ht]
	\centering
	\includegraphics[scale=0.25]{{med3-1}.jpg}
	\caption{Picture of an (a) isometric and (b) cross sectional view of the tablet bucket and its different compartments.  \cite{med3}. \label{fig:med3-1}}
	\end{figure}

The problem of the density of the tablets and the variety was solved with a bucket called the ``Hopper" which could be seen in \autoref{fig:med3-1}. The Hopper consisted of 10 compartments enabling it to simultaneously hold 10 different types of medication at any one time. The individual compartments were also sized to fit a large number of tablets solving the problem of the density of the tablets. The hopper would rotate with an opening on the bottom for a tablet to fall through into the 3DAC.

The 3DAC was theorized, in order to solve the problem of having an adaptable delivery mechanism able to dispense multiple shapes of tablets. It was designed based on models of common shapes of tablets which the team behind the 3DAC simplified into a rectangular shape of varying size for each, which would encapsulate the whole tablet. This was done to explain the choice of a rectangular cavity for the 3DAC.


	\begin{figure}[ht]
	\centering
	\includegraphics[scale=0.25]{{med3-2}.jpg}
	\caption{Picture of the 3DAC with the rods (a) unextended and (b) extended.  \cite{med3}. \label{fig:med3-2}}
	\end{figure}

The 3DAC illustrated in \autoref{fig:med3-2} shows it in two configurations. The 3DAC was designed to have 3 adjustable walls that could move to make the right shape for any specific shape of a tablet. Compressible rods were used to form the base of the 3DAC which would enable the depth of the cavity to be adjusted to the specific height of the tablet to be dispensed. This made it possible for the 3DAC to dispense a wide range of tablet shapes without having to manually change the delivery mechanism and the specific alignment of the cavity could be coded into the device. This coding would make the adjustment automatic and improve the performance of the delivery mechanism, making the 3DAC able to dispense tablets from all 10 compartments of the hopper regardless of shape.

	\begin{figure}[ht]
	\centering
	\includegraphics[scale=0.25]{{med3-3}.jpg}
	\caption{An illustration of the dispensary action of the 3DAC.  \cite{med3}. \label{fig:med3-3}}
	\end{figure}

The dispensary action of the 3DAC has been illustrated in \autoref{fig:med3-3}. As can be seen, the 3DAC would position itself under the hopper with the cavity adjusted to the requirements of the tablets in that section of the hopper. The tablet would then fall into the cavity and the 3DAC would move away from the hopper. One of the walls of the 3DAC would then give way and the compressible rods would retract to assist ejecting the tablet. During the testing this method was proven to be effective at expelling a tablet 95\% \cite{med3} of the time, giving evidence that this was a potentially successful design.

This solution to the dispensary mechanism was very adaptable but complex. The complexity might not apply to the Component Vending Machine but the ideology of a simple design that could adapt to different requirements that could be applied. This was not to say an automatic cavity should be used as that would take too much time to develop by itself and, and electronic component with pins which could easily get caught on the edges of the cavity or other components was more complex than a tablet. The hopper was also not an ideal solution for the Component Vending Machine because of the complexity of an electronic component compared to a tablet. However, having a gravity fed system such as the hopper was definitely the solution that was needed for the Component Vending Machine.

\subsection{Communication between devices}
Since it was decided to have each delivery mechanism act independently from one another and potentially a master device, a means of communicating between each device or from master to slave was needed. 

\subsubsection{I2C}
I2C was a communications protocol that was easy to use with most micro-controllers having built in hardware to deal with I2C. The main hurdle with using I2C would be failed communication due to noise. Some examples of noises would be switching noise from power supplies or the environment itself \cite{I2C} and signal generators like the ones present in UCT's White Lab.

One of the ways to improve noise immunity and improve reliability would be to use an external RC filter as suggested in the White Paper from Lattice Semiconductors. One of the hurdles with such a filter on I2C lines was finding a balance between loading and filtering. The higher the time constant ($\tau = RC$) the slower the rising edges of the line and the greater the driving load on the IO of the micro-controller. Below was an image of a recommended filter from the White Paper with a good balance between loading and filtering. The values set at $R_{pullup} = 1800 \Omega, R_{s1} = 130 \Omega, R_{s2} = 51, \Omega, C_f = 180 Pf$ \cite{I2C}.

	\begin{figure}[ht]
	\centering
	\includegraphics[scale=0.4]{{I2CRCFilter}.jpg}
	\caption{External Low Pass Noise Filter Circuit\cite{I2C}}
	\end{figure} 


\subsubsection{RS-485/TIA-485}
RS485 was considered as it was an industry standard in factories with electrical equipement needing to communicate with one another. This was because it could operate over long distances (up to 120 meters at 100kbps \cite{rs485}), and in noisy environments. This was ideal for the Component Vending Machine as it would most likely be placed in the White Lab at UCT where there were multiple devices capable of interfering with the communications bus and potentially corrupting the data as discussed in the above section. 

The network topology was similar to that of I2C where each device was ``daisy chained" to one another making what was called a bus for communications. It was common to use an IC such as a bus transceiver to facilitate the RS485 standard where the hardware does not support it and use UART, with CTS and RTS pins if available \cite{rs485}. UART cannot be used alone even with shielded cables because both devices on the bus hold their TX lines high as shown in \autoref{fig:uart}. This made it impossible for 3 or more devices to be connected on the same lines for UART as corruption would occur. 


	
	\begin{figure}[ht]
	\centering
	\includegraphics[scale=2]{{MaximSoftUartFig1}.jpg}
	\caption{When idle one can see the line would be held high, this is seen before data is sent and after \cite{UART}. \label{fig:uart}}
	\end{figure} 

Although with CTS and RTS pins, one could use the UART in RS-232 mode, however this required two extra pins to run on the bus. Using the RS-485 standard would alleviate this problem as it was designed to work on 2 lines with differential signals when using it in a half-duplex configuration. This gave RS-485 a great advantage against noise immunity as it was not susceptible to all kinds of noise. 

Noise in a system could be split into common-mode and single-ended noise of which RS-485 was immune to common-mode noise unlike standard UART or I2C. This made single-ended noise the only issue. Single-ended comes from improper transmission line termination from mismatched resistance on the output and input transmission line. This can be solved by using a terminating resistor on each node of the bus which matchds the resistance of the line impedance. In addition to proper termination, twisted shielded pairs were recommended making the bus less susceptible to interference \cite{dif}. 

\subsection{RFID Reader}
In order for students to be identified when requesting components from the Component Vending Machine their student cards would be utilized to match them with their order. This meant hardware to identify these student cards was needed. This hardware was reviewed in this section.

\subsubsection{System Specification}
There were three different classes for the operating frequency of RFID systems (low frequency, high frequency and ultra-high frequency), and 3 classes of device systems related to how they were powered (active, passive and battery assisted passive) \cite{rfidsys}. The system that was decided upon that would be used for the Component Vending Machine would be a low frequency system with an RFID Reader and Passive tag. In RFID tags were referred to as the item to be tracked or the identifier in this case the student card. The tag had an on board antenna and a ``tag-chip" which contained an ID that could either be factory set, programmable or write-once. The antenna was used to power the tag, by receiving power from the reader when in range, and transmitting data to the reader. The reader also had an antenna which was used to transmit power to the tag and receive the data being transmitted by the tag \cite{rfidhow}.

\subsubsection{UCT's RFID Solution}
Since an understanding of the fundamentals was attained, the physical reader was then reviewed. The reader to be used was a solution put together in house at UCT using the existing RDM 6300 module and MCP2200 FTDI Chip \cite{justin}.

The RDM 6300 was a 125KHz low frequency card reader for 125KHz compatible tags like the ones used by UCT for student cards. It supported an external antenna with a range of about 50mm \cite{RDM}. This was a fairly popular module in the maker community as it was relatively cheap, at about \$12.50,  compared to commercial equivalents. It was also popular because of the many resources associated with the maker community and its widespread adoption meaning any problems would be easy to troubleshoot through this community if needed. A picture of the above mentioned RDM 6300 with an external antenna attached can be seen in \autoref{fig:rfidpic}.

	\begin{figure}[ht]
	\centering
	\includegraphics[scale=1]{{125KhzUART}.jpg}
	\caption{The RDM 6300 module with an external antenna connected directly to the module \cite{RDM}. \label{fig:rfidpic}}
	\end{figure} 

The MCP2200 was a USB2.0 to UART Protocol Converter when paired with the RDM module would allowed the RFID Reader to communicate with any computer with a USB port \cite{MCP}. This would allowed the RFID reader to send data over the USB cable to the computer whenever a tag was read making it easier to interface with the RFID device. This conversion was needed as the UART interface on the Raspberry Pi was to be used for communications on the RS485 bus.

\subsection{Website, Hosting and Server}
\label{subsec:litweb}
In order to prove that the Component Vending Machine could operate with a website, an interactive and functional website would be needed. The model used for the website would be a LAMP archetypal structure, or Stack, as this was a very popular implementation of a web server. LAMP stands for Linux, the operating system, Apache, the webserver, Mysql, the database server and PHP, the scripting language used, an acronym of the software bundle used, all of which were open source \cite{LAMP}.  

\subsubsection{The Web server: Apache vs. Nginx }
In order to host a functional website, a web server had to be used. Although a LAMP stack was originally favoured, other web servers were considered. The major alternative was Nginx as it had some benefits over Apache. Its main advantage and selling point was that it could handle more connections concurrently than Apache so for a heavy duty web site Nginx was necessary \cite{Nginx}. Apache was chosen over Nginx however, as Apache was a more popular web server with widespread popularity and because the website required would not have a high client base. Netcraft did a survey every month posting the results at the end of each month. They had been getting responses from over 1 billion sites which gave credibility to the survey. According to the survey, as at the end of August, Apache had the majority share in active web sites due to its continued support with a market share of about 46\% compared to Nginx or Microsoft's 22\% and 10\% respectively, these were taken from the latest data in \autoref{fig:apache}. Although it had shown a steady decline in market share since 2011 it was still the leader in web servers \cite{Apache}. This meant support and knowledge base would be abundant making the use of Apache easier to troubleshoot over Nginx the primary contender. The graph in \autoref{fig:apache} shows the market share of each web server program over the period of August 2016 to June 2000.
	
	\begin{figure}[ht]
	\centering
	\includegraphics[scale=0.6]{{NetcraftSurvey}.jpg}
	\caption{Graph showing active websites and their backend web server being used \cite{Apache}. \label{fig:apache}}
	\end{figure}
	
Apache translated a URL that would be attached to an IP address and fetched files related to that IP address, returning them to the browser or program that the IP request came from. This could also be a program, where the server would execute the program requested and return the output. This was all done through a protocol called HTTP (Hypertext Transfer Protocol) which allowed the browser to make a request in a manner the server would understand it, similar to a protocol used to communicate between microcontrollers. More specifically for Apache, these were files stored on the computer the LAMP stack was installed on and in a directory Apache was directed to \cite{apachebook1,apachebook2}.  


\subsubsection{The Scripting Language: PHP}
If the site was directed to a PHP file or a file it saw contained PHP syntax it would pass it onto the PHP interpreter. The interpreter would then execute the code on the server side and a result would be returned with a static page like HTML. Although a static page could be served using just HTML, PHP added the advantage of enabling dynamic content based on server side variables; such as content from a database. Another advantage of PHP was it could be embedded into HTML code. This made it possible to make the UI look great with static HTML and serve embedded dynamic content with PHP. Another big advantage of PHP which helped it gain a large market share of users in its infancy was its ability to interface with multiple database servers. The one that is to be focused on in the report would be MySQL \cite{PHP}.


\subsubsection{The Database: MySQL}
MySQL was a database platform built to run independently. It managed data by storing in databases with separate tables each with its own rows and columns. It was able to relate certain data from one table to another by using user defined rules making operation and navigation fast when used properly. MySQL also helped protect the databases with proper protection giving access to users defined during configuration, making it a secure way to store sensitive data. MySQL used the ANSI/ISO standard SQL (Structured Query Language) which enabled easy access when permitted. The SQL standard and access to MySQL worked on a query basis, ie; when an SQL statement was constructed and sent to the MySQL. Once the query had been interpreted, the relevant data pertaining to the request was returned \cite{mysql}.  

\subsection{ATX Specification}
In order to power the Component Vending Machine, a computer power supply was to be used. In order to understand how to use this power supply connection, the standard used was investigated. The standard used for computer power supplies was well documented and open source, which was called the ATX Specification and was made by Intel \cite{ATX}. Additionally, tutorials were followed on how to setup the ATX connection for use outside of motherboard applications to be thorough. Revision 2.1 of the ATX specification was used instead of the latest 2.2 as the latest version had been updated to only cover ATX2 which was an updated standard adding addition pins for newer motherboards.

	

	\begin{figure}[ht]
	\centering
	
	\includegraphics[scale=4]{{ATXCON}.jpg}
	\caption{ATX 20 pin connection layout \cite{ATX}. \label{fig:atx}}
	\end{figure}
	
The ATX standard complied with the specifications set out by Intel to operate their processors. This was useful as an ATX compliant power supply had a 12V; 5V and 3V3 supply line capable of supplying a large amount of current. The connection layout is illustrated in \autoref{fig:atx}. In order to use the power supply specific connections needed to be made and certain power rails had to be used. A kettle plug had to be connected for the AC power to power up the PSU. The AC switch had to be turned on and the ``PS\_ON\#" must be grounded to supply power over the 12V, 5V and 3V3 rails. If left open, the voltage rails would be shut off . A ``PWR\_OK" output was provided from the power supply that indicated if the voltage rails were supplying the correct voltages with a high signal \cite{ATX}. This was not necessary for operation but convenient for indication. In order for the power to maintain a constant voltage it may need to be tricked into thinking it was connected to a motherboard. This could be done by connecting a 5W load to the 5V rail \cite{ATXON}.

	\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%system specifications
\section{System Specifications}\thispagestyle{sectionstart}
In order to begin designing the Component Vending Machine, the specifications needed to be defined in detail in order to know what the designs needed to focus on. There will be three major sections in the design and discussion of this report. Those will be; the mechanical design including the delivery mechanism and enclosure, the PCB design of both controller for the delivery mechanism, which will be called the MCU module from now on, and the Raspberry pi module plugin, and the software for the Master program i.e. the Raspberry Pi, the MCU modules and the website. A mind map was created to assist defining the specifications and can be seen in \autoref{fig:specdef}. It shows the relevant specifications for each three sections and how they interact.

	\begin{figure}[ht]
	\centering
	\includegraphics[scale=0.15]{{SpecDef}.jpg}
	\caption{Mind map used to help assist the definition of the topic, system specifications and design of the Component Vending Machine. \label{fig:specdef}}
	\end{figure}
	
A mind map is also included in \fullref{sec:resmm} which was created on commencing this research to better define the topic and help decide on a direction to take. This mind map is a precursor to the mind map above but not as relevant to this section.

\subsection{Mechanical Specifications}
The mechanical specifications and requirements will be discussed in more detail below.
\subsubsection{DIP Specifications}
The dimensions of various DIP components were measured in order to determine the design requirements for the dispensers. The method of investigation was searching a well-known vendor's site\cite{mantech}  for datasheets on the various DIP components. Datasheets were checked for dimensions until 5 different measurements were obtained, the list is summarized in \autoref{tab:dipd}.
\newpage

	\begin{table}[ht]
	\centering		
	\begin{tabular}{| m{2cm} | m{2cm} | m{2cm}| m{2cm} | m{2cm} |}
	\hline
	& DIP 8 & DIP 14 & DIP 16 & DIP 20 \\
	\hline
	& 9.6 & 20 & 19.55 & 25.73\\
	\hline
	& 10.66 & 19.5 & 20.32 & 26.42\\
	\hline
	& 10.16 & 20.19 &19.5 & 27.17\\
	\hline
	& 10.82  & 19.5 & 21.97 & 25.4\\
	\hline
	& 10.2 & 20.32 & 19.81 & 24.5\\
	\hline
	Range & 9.07 - 10.66 & 19.5 - 20.32 & 19.5 -21.97 & 24.5 - 27.17 \\
	\hline
	Average & 10.06 & 19.19 & 20.23 & 25.84 \\
	\hline
	\end{tabular}
	\caption{DIP package dimension for various components measured in millimeter. \label{tab:dipd}}
	\end{table}

From the data collected it showed that there were only 3 different packages to cater for, as the DIP 14 and 16 packages were observed to be very similar.
\subsubsection{Delivery Mechanism}
The main objective of the delivery mechanism needs to be stated as being able to deliver one component at a time in a reliable manner. The delivery mechanism needed to be very reliable with a success rate of 95\% or above. It was set high because a failure in the system would mean human intervention to correct the error breaking the autonomous nature the Component Vending Machine was to have. This autonomy was another specification as the Component Vending Machine was to operate at potentially late hours of the night when no authority to amend a failure would be available. To improve autonomy, component tubes, pictured below, would need to be held in the machine while being fed into the delivery mechanism to give the Component Vending Machine a large capacity.

	\begin{figure}[ht]
	\centering
	\includegraphics[scale=0.13]{{ComponentTubes}.jpg}
	\caption{Two tubes of components, the top full of DIP IC Holders and the bottom one being full of DIP 8 Components.}
	\end{figure}

\subsubsection{Enclosure}
The enclosure's priority specification was, to be able to hold all the modules of the Component Vending Machine. The enclosure also needed to be able to have space for expansion for future requirements that may arise after the completion of this research to keep the project as a whole alive. It should also be able to prevent people from sticking their hands into the machine and interfering with the operation of the Component Vending Machine. Lastly, the enclosure should be able to present the dispensed components in a manner easy for the person ordering, to retrieve. 
\subsection{PCB Specifications}
The PCB requirements and specifications will be discussed in more detail below.
\subsubsection{Raspberry Pi}
The main purpose of the PCB that would interface with the Raspberry Pi, was to be able to power the Pi and create a starting point for the communication the bus. This module should also be able to sense if the door of the enclosure was open. This would be to prevent the machine from dispensing components or from moving parts, while someone could potentially have their finger in the mechanism to try and fix a fault. 
\subsubsection{MCU Modules}
The MCU module had many small specifications, contributing to serve the main purpose of being modular and interchangeable for different types of delivery systems that must be required. It would need to operate a DC motor, stepper motor, and servo motor, either one at a time or all at once. Gap sensors should be able to detect an empty load for delivery or a jam, or a low cartridge or a tube. It was later decided that the MCU module should be able to operate an LCD. This was so that messages could be relayed to someone using the Component Vending Machine, i.e, to communicate a problem with the machine. A micro-controller capable of handling the specifications of the MCU module should be coupled with a crystal designed to the microcontrollers specifications was needed. A communication and power bus that could be daisy-chained to additional modules was required for expansion. This was so that more than one module could be attached to the same communication bus. Calibration controls to adjust and fine tune the operation of the device were needed to enable adjustments. This would allow for small imperfections in manufacturing and building to be circumnavigated by changing set limits in the code.
\subsection{Software Specifications}
The specifications of the Software requirements and specifications will be discussed below.
\subsubsection{Master Program for the Raspberry Pi}
The main function of the Master program needed be to recognize student cards and the student number attached to them and communicate with the MCU modules. This communication would allow the Master program to control the actions of each MCU module when needed. The Master program must also manage the database and had to make sure the orders were not invalid. Another feature the Master program needed to have was administrative control in order to be able to induce additional administrator features on each MCU module for maintenance purposes. The Master program should under no circumstance record any user ID's or information taken from a student card.
\subsubsection{MCU Module}
\label{subsec:mcuspec}
The specification for the program was set out to make sure the program ran reliably. To ensure this, one of the first requirements was that the MCU would use very few delays and instead use a task manager. The task manager needed to enable the MCU module to operate without delays when dispensing components so that the system would not be held up by any one task. In addition to the task manager, motor control for the 3 kinds of motors had be present. Detection for empty load and low cartridge/tube using optical gap sensors was required so the module could sense if a component were present in the mechanism or not. An address storage system must be in place so that the device would know when it had been commanded over the communication bus. Finally, the MCU module had to required to have a task manager to calibrate the device and save the newly set values. A summary of the I/Os needed has been listed below:
	
	\begin{itemize}
	\setlength\itemsep{0em}
	\item 22 I/O
	\item 3 Analog Inputs
	\item 1 PWM Channel
	\item 1 UART Interface		
	\end{itemize}
	
\subsubsection{Website}
The website was a proof of concept in order to show the device was capable of interacting with the information saved by a website. The web page needed to be easy to use for users wishing to make orders from the Component Vending Machine. There should be a comments section of some form, so users could give feedback or report problems with the Component Vending Machine. The website should also be able to interface with the database in order to store and read data from it.

\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	% design and prototyping
%\section{Design and Prototyping Methodology and Procedure}\thispagestyle{sectionstart}
\section[Design and Prototyping Methodology and Procedure]{Design and Prototyping Methodology and Procedure%
\sectionmark{Methodology and Procedure}}
\sectionmark{Methodology and Procedure}
Prior to beginning the design A clear methodology was needed to proceed in order to get the best results. This included a set of rules to follow when designing and testing prototypes. This section aims to discuss these and elaborate on how the design was approached to meet the requirements set out in the previous section.

\subsection{Design}
The methodology behind the mechanical design will be reviewed first, then circuit design, software design and finally the prototypes:
\subsubsection{Mechanical Design Methodology}
In order to make an effective design, certain constraints were first laid out to limit the scope and complexity of the design.

A simple design approach was used to limit the complexity where simplicity and the method of forward thinking; ``how would it fail", were always the first and ongoing design considerations. Once a simple idea was theorized, details were added in order to make it more functional. Simplicity was not the main goal as complexity would be needed in some cases, i.e., where functionality took priority. The number of moving parts would be kept to a minimum to reduce complexity in order to prevent failure of functionality and structure. 

Design of the delivery mechanism started out on paper as sketches of basic ideas, until these culminated into a practical idea. Once ready, the idea was designed in SolidWorks with the previously mentioned requirements. After the Model was fully defined in SolidWorks, the model was printed on a 3D printer to prototype and test the effectiveness of the design. If the design had flaws, a redesign was done to change and eliminate those flaws and the model was printed again to further test and find any other potential flaws. This process was repeated until a reliable working prototype for the delivery mechanism was produced.

As for the enclosure, a similar process was followed, as was for the delivery mechanism. However, no prototyping was included as the cost for prototyping would have been too high. Another reason for no prototyping for the enclosure, was that the functionality was not as complex as the delivery mechanism. This meant that it was designed with measurements more so than functionality in mind. However, this is not to say functionality did not play a part in decision making. The frame of the enclosure was designed first, followed by the internal housing for the delivery mechanism. The Raspberry pi and power supply were designed thereafter. The next step was that the shell was designed along with the slide for the components to fall down and then the front door. Once the design was completed, all the parts were detailed in Solidwork sketches to finalize the design.

\subsubsection{Circuit Design Methodology}
The basic idea behind the design of the PCB was to make it versatile and able to adapt to the requirements of the project by adding in features to allow for multiple configurations of mechanical delivery requirements. This required a somewhat modular design.

The circuit started with a sketch on paper detailing what would be needed in the final design and what type of configurations it should be able to handle. A schematic was then created in EagleCAD allowing for a more formal design. The schematic was then turned into a board using the same software. The layout of the board was adjusted and configured until a satisfactory layout for the PCB was achieved.

\subsubsection{Software Design Methodology}
The software for the machine is one of the most important aspect to consider, as it would influence each part of the design and how they would interact.

The software design started with algorithmic state machine diagrams in order to simplify the understanding of the programs and how they would operate. Once an adequate algorithmic state machine diagram was achieved, programming was started. The program was split up into 3 main modules: Website, Master and Delivery Modules. 

The website was designed using knowledge learned during the research building up to making the Component Vending Machine. It was designed to be easy for the user to understand and operate, as the UI for the interaction for the students who would eventually use the Component Vending Machine. Although the website was designed to be independent from the Master and Delivery Module code, it was briefly tested with them to confirm its functionality.

The Master and Delivery Modules were similarly and at times, concurrently designed in order to test their compatibility. Both were designed with a modular approach with each small block of code being developed and tested independently before integrating with the main code base. This allowed each small block of code to act on its own without interfering with other blocks of code, making the overall design more reliable. This also helped make debugging easier, speeding up the programming process.

Finally, all three modules were integrated together and tested thoroughly and updated until a working code base was achieved. 

%\subsection{Prototyping Methodology and Procedure}
\subsection[Prototyping Methodology and Procedure]{Prototyping Methodology and Procedure%
\subsectionmark{Prototyping}}
\subsectionmark{Prototyping}

Detailed planning and methodology was needed in order to test the viability of the prototypes for the final build.

In ordero test the viability of the mechanical design of the delivery mechanism, a structure for testing and guidelines were drawn up to make sure each test was comparable to the following tests. This was done by making sure the tests were repeatable by eliminating external variables and utilizing a test method that could be used for all test cases. Also, a recording structure was created with data that would be recorded from test to test. Notes were also taken with each test to add contexts and additional information of the success or failure of the tests.

\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Component and Material Selection}\thispagestyle{sectionstart}
This section will cover the components and materials selected for the design of the Component Vending Machine and why they were selected. The selection for the electronics entailed parts for the PCB which would enable the delivery mechanism to operate, the Master board that would control each addressable PCB and the power supply. The material selection ranged from materials used in the delivery mechanism to the metals and plastics needed for the enclosure.

\subsection{Communications bus}
\label{subsec:bus}
In order to communicate using an RS485 bus, a differential bus transceiver, was needed to convert the UART signal. The SN75176B was chosen as it had many advantages over and above numerous other differential bus transceivers. It acts as a half-duplex RS485 device when connected to a RS485 bus meaning it can only communicate one way at a time which met the communication's requirements. It also meant only two wires would be needed for communication plus a common ground. To manage the half-duplex communications, each transceiver had data enable and receive enable triggers to allow it to communicate and receive data only when needed, allowing the device in control to manage its communications better, i.e. when tasks would be performed and no communication would be expected or needed it could turn off its bus connection. This would allow for more reliable task execution.

\subsection{Servo Motor}
In order to drive the roller version of the delivery mechanism, an appropriate servo motor was needed. The Hextronik 9g servo was selected, or any 9g servo equivalent (9g stands for the weight of the servo), as it was inexpensive at \euro 2,42 \cite{hobbyking}, at the date of compiling this report. It was capable of moving the rollers and was light and compact making the overall design compact. Later on though, it was decided to use a stronger and more reliable Corona DS-339 as it did not have overshoot that was observed in testing on the 9g servo. Although it was more expensive at \euro 7,61 \cite{hobbyking}, it was more readily available at UCT.

\subsection{Stepper motor and Driver}
Although a stepper motor was not used in any of the final builds, the design catered for a stepper motor for future development. The stepper motor the PCB was designed for, was the NEMA 17. This stepper motor was chosen as it was a fairly commonly used stepper motor and popular in the 3D printing community, RepRap project \cite{reprap}, meaning trouble shooting potential problems would be easier than using another motor.

The stepper motor driver chosen to be compatible with the Component Vending Machine was the A4988 Ramps board. The stepper motor driver was from the same community that popularized the NEMA 17. This meant the compatibility had been tested making the two an ideal pair.

\subsection{Power Supply}
The power supply chosen was a PSU from a computer. The computer PSU was chosen as it could supply 3.3v, 5v and 12v simultaneously and provided enough power to operate all the electronics concurrently. It was also chosen as it would eliminate the design process of making a power supply and provide a more reliable and effective solution.

\subsection{Microcontroller}
The choice was narrowed down to two microcontrollers, the STM32F051C6 and the ATmega1280. They both met the requirements set out in \halfref{subsec:mcuspec}. In the end, the STM MCU was chosen over an Atmel MCU based system mainly because of cost and that it was more accessible at UCT. An Atmega1280 cost above R200 where as the STM MCU cost around R30 \cite{rsonline}, at the date this report was compiled. 

The STM MCU featured a 48MHz max system clock with 32Kbytes of flash and 8Kbytes of SRAM. It had 11 timers in total which would assist with the PWM channel and task manager. It had 27 available I/O channels. Of those 27 channels 10 could be mapped to the ADC, 6 could be mapped to the timers and used as PWM channels. Additionally, the STM MCU had 2 UART interfaces.

\subsection{Delivery Mechanism Housing}
It was decided that the housing structure for the delivery mechanism would be clear 2mm acrylic glass. This was because acrylic glass would be able to handle the small forces applied to the mechanism. It was also chosen, as acrylic glass was easy to cut given that a laser cutter was used, making for accurate assembly of the design. Lastly, clear acrylic glass was specifically used so the housing would not impede viewing the of the delivery mechanism for the assembly, maintenance and repair. 

\subsection{Enclosure Frame}
Steel L beams and bars where chosen as the frame for the enclosure. Steel was chosen because it would be strong and durable making the enclosure last long. Also, steel was one of the easier metals to weld making it ideal, as the facilities were common for welding steel.

\subsection{Enclosure Casing}
Aluminium was chosen over acrylic glass for the casing for the enclosure. This was because aluminium is stronger than acrylic glass making it harder for people to tamper with the enclosure and breach it to access the interior. Acrylic glass and aluminium were roughly the same price per meter$^2$ making the advantages of aluminium the obvious choice.  

\subsection{Enclosure Shelving}
Wood was chosen for the shelving for the delivery mechanisms, as it was the most cost effective solution when compared to steel, aluminium or acrylic glass. Wooden planks 12mm thick would be used to meet the requirements of the shelving.

\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	%system design and prototyping
\section{System Design and Prototyping}\thispagestyle{sectionstart}
The design of the Component Vending Machine has been split up into three sections as prior sections have been. The mechanical design will be presented first, then the PCB design and finally, the Software development and design. Prototyping will be presented where relevant but not in its own section, in order to maintain its context with the design it is related to. All 3D models, unless specified otherwise, were produced using Solidworks.
\subsection{Guide For Component Tubes}
\label{subsec:Guide}
In order to help make restocking the Component Vending Machine easier, the delivery mechanism would be fed from the same component tubes the components were stored in. The idea was also to make the delivery mechanism gravity fed, an idea inspired by the literature review discussed in \autoref{subsec:med1} and \autoref{subsec:med3}. This would mean restocking would only entail disposing of the empty tube and fitting in a full tube of components, instead of individually loading each component. A guide for these component tubes was needed to keep them in place and make restocking simple for the user. This guide was called the IC guide. Although the Guide did not change much through each version, improvements were made to compensate for ech problem encountered. Although the Guide forms part of the delivery mechanism, it deserved an update review of its own, therefore, the relevant changes are presented in this subsection.
\subsubsection{IC Guide Version 1}
The Guide was to hold a component tube for DIP IC's which have a trapezoidal shape.
	\begin{figure}[ht]	
	\centering
	\includegraphics[scale=0.2]{{guide1}.jpg}
	\caption{IC Guide (a) detailed diagram and (b) isometric view. \label{fig:g1}}
	\end{figure}
	
In \autoref{fig:g1} the IC guide has been depicted in (a) detailed diagram showing features and (b) an isometric view for a real life rendering. The component tube would fit in the centre of the guide in the ``Guide Path". Gaps were added for an IR LED and IR phototransistor so the rail could be monitored at the ``Gap for sensor". This sensor would be able to detect if the level of the IC's in the tube were below the height of the gap providing information about the stock of the tube. Holes for screws were added to allow for tightening of the structure to grip onto the tube at ``Hole to tighten grip". Two holes were made by different heights to distribute the load of the screws, reducing pressure applied at each point and thereby preventing failure of the IC Guide from cracking or snapping. This was tested with a mock build, which showed signs of fatigue with only one compression hole. A lip was added at the bottom to properly align it with the delivery mechanisms structure shown as ``Lip for alignment. Holes on the feet were also added to fasten the guide to the delivery mechanisms' structure, shown as ``foot for stability" and ``Hole for screw".

This version was deemed unusable, as tubes of varying thickness were encountered, making it impossible for the delivery mechanism to operate reliably. This was caused by the guide squeezing the tubes and causing a jam in the tube.

\subsubsection{IC Guide Version 2}
 
	\begin{figure}[ht]	
	\centering
	\includegraphics[scale=0.3]{{guide2}.jpg}
	\caption{Comparison between Version 1 and Version 2 of the IC Guide. \label{fig:g2}}
	\end{figure}

Version two of the IC guide improved on the design of the first and addressed the problem of thicker tubes by expanding the guide hole slightly. Other changes included making the walls of the guide thinner to reduce material costs for 3D printing and adjusting the feet from the sides to the front and back. The changes can be seen in \autoref{fig:g2}. This helped to reduce the footprint of the overall structure of the delivery mechanism. Additionally, holes were placed so screws could fit to press up against the tube and further fix it in place.

\subsubsection{IC Guide final}

	\begin{figure}[ht]	
	\centering
	\includegraphics[scale=0.45]{{guide3}.jpg}
	\caption{Labelled picture of the final version of the IC guide. \label{fig:g3}}
	\end{figure}

The final version of the IC Guide changed three details of the design. First, the gap for the sensor was moved to the bottom and 2 additional gaps were added to allow for alignment of the gap and IC to be dispensed. The alignment lip was removed to allow for a more adjustable design per IC and compensate for possible misalignment caused by manufacturing and assembly. Lastly, all 90\degree corners which were overhanging were changed to 45\degree slants to reduce supports being produced in 3D printing, reducing material costs. These changes can be seen in \autoref{fig:g3}. Additionally, a guide for IC holders was designed, as the tube for IC holders were rectangular. The guide hole was simply changed to fit this shape. This has been illustrated in \autoref{fig:g4}.

	\begin{figure}[ht]	
	\centering
	\includegraphics[scale=1]{{guide4}.jpg}
	\caption{Rectangular IC guide for DIP IC holder tubes. \label{fig:g4}}
	\end{figure}

A detailed drawing of the final design of both the IC Guides, DIP Components and DIP Holders, can be seen in \fullref{subsec:g1} and \fullref{subsec:g2}.
	
\subsection{Delivery Mechanism}
The delivery mechanism design and prototyping will be presented in this section, with version ranging from the preliminary design to the final design.
\subsubsection{Vertical Roller Version 1}
The vertical roller was named after the axis the part pivoted on. This pivoting motion was performed by a servo motor. This roller was designed to be able to be 3D printed, using PLA or ABS.
%%%%%%%%%%%%%%%%%%%%%%% 
	
	\begin{figure}[ht]	
	\centering
	\includegraphics[scale=0.3]{{v1}.jpg}
	\caption{Vertical roller and housing delivery mechanism. \label{fig:v1}}
	\end{figure}

The ``Vertical Roller" as labelled in the \autoref{fig:v1} was situated in the ``Housing Structure", made of 2mm acrylic glass, that would enable it to pivot on the vertical axis with the assistance of a servo motor. The housing structure had a width of 103 mm to keep it stable, allowing for 9 delivery mechanisms to be placed on a 1 m span. The design of the roller consisted of a bucket for the DIP component to drop into. This bucket would be situated on a wheel that would pivot the bucket from a position where a component would drop into the bucket. The bucket was designed to accommodate a component with splayed legs, hence took on a trapezoidal shape. The dimensions of the bucket were determined by measuring dimensions on a DIP component. The wheel would then pivot to a position where the component would fall out. This position has been depicted in the \autoref{fig:v1}. A plate labelled ``Guide plate" was designed to force components to fall away from the housing if they fell straight down. The components would be guided into the bucket by the ``IC Guide". The design of the IC guide has been detailed in \fullref{subsec:Guide}. A more detailed drawing of the delivery mechanism in its housing can be seen in \fullref{subsec:v1}.

	\begin{figure}[ht]	
	\centering
	\includegraphics[scale=0.24]{{VertV1}.jpg}
	\caption{Vertical roller (a) cross section  (b) isometric view (c) view to help explain loading.\label{fig:multi}}	
	\end{figure}
	
In \halfref{fig:multi}, labelled (c), IC1 will be the name given to the component in the bucket. IC2, as shown in the figure above, will be the name given to component that would be loaded in the next loading cycle of the mechanism. This naming convention of IC1 and IC2 will be used in this report from now on. This diagram explains how IC's would be guided into the bucket, one on top of another from a tube situated in the guide, which would be positioned above the delivery mechanism.

The \halfref{fig:multi} shows a cross sectional (a) and isometric view (b) of the vertical roller. The cross sectional view shows the features of the part. The cavity labelled ``Component bucket" is where the DIP package would fall into when being loaded, for this design it would be DIP 8 components. A ``Fillet" was added to prevent the next IC to be loaded from catching on the wall of the bucket. The slot labelled ``Gap for sensor" would house an IR LED and an IR phototransistor, one on either side. The cavity at the bottom of the bucket was for a vibration motor, which would assist in loading and dispensing components. The idea behind the vibration motor was to assist the component if it became jammed. A ``Frame" was to maintain structural rigidity. The isometric view shows detail of how the design would look in real life. A ``Foothold for servo horn" has been labelled, which would be to assist the servo motor attach to the roller to pivot it along the vertical axis. The part was hollowed out to reduce material costs for 3D printing and the wheel form was used so the wall of the disk could be used to block IC2 as the roller would pivot. 	

\subsubsection{Prototyping Vertical Roller Version 1}

A prototype of the delivery mechanism was built to test its functionality and reliability. A portion of the testing can be seen in the video \cite{verttest1p1,verttest1p2}, or on the accompanying CD named ``Video 1" and ``Video 2". The parts for the housing were laser cut from scrap acrylic glass reducing the prototyping costs. The vertical roller and IC guide were 3D printed using PLA. 
\newpage
	\begin{figure}[ht]	
	\centering
	\includegraphics[scale=0.1]{{verttv1real}.jpg}
	\caption{Prototype of delivery mechanism using the vertical roller.\label{fig:proto1}}	
	\end{figure}
	
In testing, the prototype had a reliability factor of just fewer than 76\%. This made it unreliable and did not meet the requirement of 95\%. The main cause of failure was IC1 pushing up on IC2 when the roller was rotating to release IC1, as depicted in \halfref{fig:jam}. Two other common failure modes that occurred, were IC2 being jammed up against the fillet and IC1 when being loaded, would catch on the lip of the bucket. Another undesirable characteristic observed, was that IC's would be ejected unpredictably, i.e., snapped out at speed, instead of a controlled fall.

	\begin{figure}[ht]	
	\centering
	\includegraphics[scale=0.8]{{DIPJAM}.jpg}
	\caption{Common jam action that occurs with vertical roller.\label{fig:jam}}	
	\end{figure}



\subsubsection{Vertical Roller Version 2}
Version 2 of the vertical roller was to improve on the mechanical failure caused by the fillet of the first version. A sloped fillet was added to prevent the IC1 from catching on the lip of the bucket when being loaded. It was deemed that the failure caused by jamming of the IC1 on IC2 could be mitigated by changing the way the mechanism operated by way of programming. Additionally, a centre hole was added to the servo foothold to make it possible to align the centre of rotation of the servo with the roller.

	\begin{figure}[ht]	
	\centering
	\includegraphics[scale=0.3]{{vertv2}.jpg}
	\caption{Changes made to the vertical roller for version 2.\label{fig:vertv2}}	
	\end{figure}

\subsubsection{Prototyping Vertical Roller Version 2}
The housing for version 2 was the same as version 1, as all that needed to change was the roller. The roller was swapped and the prototype was tested for reliability and functionality. A portion of the testing can be seen in the video \cite{vertv2}, or on the accompanying CD named ``Video 3". Although the problem of IC1 jamming up against IC2 had been reduced because of changing the functionality of the mechanism, reliability of the device was still below 95\%. At just above 86\% the design was deemed unreliable. The common mode of failure of an IC being caught on the lip of the bucket was still present. However, undesirable flinging of components was eliminated and IC's no longer jammed up against the slope which was a fillet in version 1.

\subsubsection{Horizontal Roller Version 1}
The horizontal roller just like the vertical roller, was named after the axis it pivoted on. Also driven by a servo motor, it was designed to be more reliable than the vertical roller  and be 3D printed from either PLA or ABS.
	
	\begin{figure}[ht]	
	\centering
	\includegraphics[scale=0.3]{{horv1}.jpg}
	\caption{Horizontal roller and housing delivery mechanism. \label{fig:hv11}}
	\end{figure}

The idea for the horizontal roller was inspired by a combination of the literature review in \halfref{subsec:med2} and \halfref{subsec:med3}. The ``Horizontal roller" labelled in \halfref{fig:hv11} would be situated in a ``Housing structure" made of 2mm acrylic glass. The housing structure had the same span as the vertical roller. Additionally, the design was intended to be more adaptable with regards to the range of DIP components it could accommodate. In theory, if a longer DIP package was required, the height of the roller could be modified in order to satisfy the requirements. Another benefit of this design was that the wall of the servo and the housing created a closed channel to expel the components in a controlled direction, reducing the possibility of a component falling back and failing to expel from the mechanism. A more detailed diagram of the housing and roller can be seen in \fullref{subsec:h1}. 

	\begin{figure}[ht]	
	\centering
	\includegraphics[scale=5]{{hr1}.jpg}
	\caption{Labelled isometric view of the horizontal roller. \label{fig:hv12}}
	\end{figure}
\newpage

The horizontal roller has been illustrated in \halfref{fig:hv12}. The feature labelled ``Gap for sensor" would be for the IR LED and IR phototransistor that would detect if a component were in the bucket. A ``cavity for a vibration motor" was made to assist loading of IC1 into the bucket. A slope was added to assist by gradually pushing IC2 up and the ``Surface to stop IC2" would hold it up while IC1 would be dispensed. The feature labelled ``Foothold for servo horn" and the ``Center hole for servo" were to attach the horizontal roller to the servo horn and alight it with the centre of rotation for a balanced rotation. 

This design worked by first loading a component, IC1, in the bucket. Then the roller would rotate about 90\degree. The component would then fall down, out of the bucket onto the guide plate and then be expelled. The roller would then rotate back to where it started to let another component drop into the bucket.

The horizontal roller was designed to eliminate some of the problems encountered with the vertical roller. Firstly, the problem of IC1 being caught in the bucket would be eliminated by employing a horizontal roller that used a different method to expel the component. Secondly, the problem pertaining to IC2 jamming up against IC1 as illustrated in \halfref{fig:jam}, was addressed by rotating IC1 instead of moving tangentially on the circumference of the roller away from IC2. This was because the force on IC1 by IC2 would be localized to one corner when rotating instead of being distributed across a surface when moving tangentially on the circumference of the roller. Lastly, unpredictable ejections would be eliminated as the component would be dropped down a guide controlling its fall path instead of being flung out as was the case for the vertical roller.

\subsubsection{Prototyping Horizontal Roller Version 1}
Another prototype of the delivery mechanism was built. The housing structure was made again as it was different from the vertical roller. Again, the housing was made of 2mm scrap acrylic glass, to keep prototyping costs low and the roller was 3D printed using PLA. A portion of the testing can be seen in the video at \cite{newhor}, or on the accompanying CD names ``Video 4".
	
	\begin{figure}[ht]	
	\centering
	\includegraphics[scale=0.1]{{horv1real}.jpg}
	\caption{Picture of the prototype delivery mechanism with the horizontal roller. \label{fig:hrv2}}
	\end{figure}
\newpage
The prototype was tested and was seen to have a reliability rating of just above 96\% meaning it met the required 95\% reliability rating. The main causes of failure were; not loading into the bucket and getting caught on the lip. Although these failure modes were reduced, they were still present. The vibration motor was intended to help with this issue. A second cause of failure was the component being lightly jammed in the bucket when trying to drop out. This was called a light jam as a small tap on the roller would expel the component. The vibration motor was intended to assist with this issue as well.

\subsubsection{Horizontal Roller Final Version}
The final version of the roller was designed to reduce printing costs as it needed supports to print. By using 45\degree slopes, which the printer could handle, the required supports would be reduced and bring material costs down. The housing footprint size was reduced in order to increase the density of delivery mechanism that could be packed into the enclosure, increasing the potential for more variety and density of components in the Component Vending Machine.
	
	\begin{figure}[ht]	
	\centering
	\includegraphics[scale=0.3]{{hfinal}.jpg}
	\caption{Final design of the horizontal roller and housing. \label{fig:hf}}
	\end{figure}

The servo motor was changed to a stronger servo motor, Corona DS-339, not because it needed the power but because the previously used 9g servo intended to rotate the roller, used plastic gears and over time this could have led to threading. Whereas, the stronger servo motor had metal gears which would not thread as easily. Another reason for using the stronger servo was that it had a better build quality and responded to input more accurately. This accuracy refers to the 9g servo having overshot when the roller was attached, causing a problem with the servos control algorithm and making it slightly unreliable. Lastly, the stronger servo was chosen over the 9g servo as it was more readily available than the 9g servo. The new ``Housing Structure" now measured with a width of 65.4 mm meaning that on a 1m span, 15 delivery mechanisms could be placed. This was an increase of 6 from the previous design.

	\begin{figure}[ht]	
	\centering
	\includegraphics[scale=0.25]{{hfinalcomp}.jpg}
	\caption{Comparison between version 1 and final version of horizontal roller \label{fig:hf1}}
	\end{figure}

In addition to 45\degree inclines, where supports in 3D printing would be needed, a ``Gap for wires" was added as can be seen in the side-by-side comparison of the roller versions. This gap was added so that the wire from the sensor on the front of the bucket could be tucked back through the hole and be neatly attached to the PCB behind the roller. The final design catered to multiple package sizes of DIP components, those being DIP 8,14 or 16 and 20. 
	
	\begin{figure}[ht]	
	\centering
	\includegraphics[scale=0.25]{{Rollers}.jpg}
	\caption{All rollers to dispense DIP 8, 14 or 16 and 20 for comparison. \label{fig:hf2}}
	\end{figure}

The heights of the rollers wheels were determine by using the average of the component length obtained in \halfref{tab:dipd} and rounding to the nearest integer. Designs were produced to cater for these measurements as shown in \halfref{fig:hf2}. Detailed drawings of the delivery mechanism that accommodates each version of component package length can be seen in \fullref{subsec:h3}. Versions of the roller for DIP IC holders were also designed, providing for different heights for each package length. All versions of the DIP roller can be seen in a detailed drawing in \fullref{subsec:h4}.

\subsubsection{Untested design: Feed-Up}

A third delivery mechanism was theorized and partially designed. It was not tested or built as the horizontal roller worked well enough that an improved design was not necessary. The feed-up method used a very different delivery method. Instead of using a gravity fed system, the components would be pushed up and out of the component tube. This would be achieved by using a stepper motor and a timing belt with a plate attached to the timing belt being pushed up the tube.

	\begin{figure}[ht]	
	\centering
	\includegraphics[scale=1]{{Feedup}.jpg}
	\caption{Feed up design with cutaway and top view to illustrate how it operates. \label{fig:feedu}}
	\end{figure}

This design originated from using a feed screw to push the components up. That was deemed inefficient as it would require a lot of space to house the delivery mechanism with a feed screw and an IC tube. The solution, as illustrated in \halfref{fig:feedu} was to use a timing belt with a small push plate-like attachment that would gradually push the components in the component tube up, as the timing belt progressed. The component would reach the top of the tube and be pushed out and fall. This fall would be controlled by tilting the mechanism in a specific direction so the fall could be predictable. The timing belt would be driven by a stepper motor with pulleys, as the fine movement from a stepper motor would provide the accuracy needed. The steps could be counted to determine how far the plate was up the tube and how far it needed to travel to dispense a component.

The reason why this design was not favoured was because of its complexity and the fact that a modified component tube would be needed. This modified component tube would be fixed and the restocking process would entail manually placing components in this tube. The complexity stemmed from the mounting, although trivial by itself, it would be more complicated than the previously discussed solutions. This design may have had some advantages as it was designed to be non-component specific, meaning one design could satisfy the specifications of multiple package sizes. The success of the horizontal roller was the main reason why the feed-up design was never tested. 

\subsection{Enclosure}
This section presents the design of the enclosure that would house the delivery mechanisms and the electronics that made up the Component Vending Machine. The enclosure design started with a frame to attach all the components and supports needed. The frame was divided into two sections to determine the measurements. Th bottom section would be for a guide slope for components to fall down into a compartment for the user to collect their order. The upper section would be the compartment housing the interior parts of the Component Vending Machine.

	\begin{figure}[ht]	
	\centering
	\includegraphics[scale=0.27]{{Frame}.jpg}
	\caption{Frame of the enclosure illustrating the upper and lower compartments. \label{fig:frame}}
	\end{figure}

The ``Upper Compartment" of the frame, as illustrated in \halfref{fig:frame}, was designed to fit the tallest delivery mechanism, that being the DIP 20 dispenser and the longest measured component tube, plus a little room for error as well as potentially taller component tubes. The DIP 20 dispenser measured in at about 100 mm, from the base to the top of the housing structure. The tallest component tube measured came in at about 600 mm, with an additional 150 mm for potentially longer tubes and 10 mm for error, leading to an upper compartment height of  860 mm. The width of the enclosure was determined by the space required to fit 3 rows of dispensers in the Component Vending Machine leading to a width that was rounded off to 600 mm. The ``Lower Compartment" was designed to fit a sloped piece of aluminium that would guide the dispensed components to a ``Bucket", labelled in the top view, accessible to the user to collect the component. This sloped piece of aluminium has been illustrated in \autoref{fig:sloped}.

	\begin{figure}[ht]	
	\centering
	\includegraphics[scale=1]{{Angled}.jpg}
	\caption{A detailed drawing of the sloped plate. \label{fig:sloped}}
	\end{figure}
	
This sloped plate was designed to have an angle of incline above 45\degree to ensure that components would not be caught on the slope and fail to reach the bucket. For this reason, 50\degree was chosen. A render of the plate can be seen in \autoref{fig:sloped}. The remaining dimensions were purely designed to fit within the enclosure. The Enclosure casing was designed next. Aluminium sheets were used to cover the frame and prevent intentional tampering.

	\begin{figure}[ht]	
	\centering
	\includegraphics[scale=4]{{case}.jpg}
	\caption{Isometric and top view of the enclosure with the case on interior. \label{fig:case}}
	\end{figure}

The sheets that covered the enclosure can be seen in \autoref{fig:case}. Inside, one can see 3 planks of wood as the shelving. The wood plank furthest to the back has a delivery mechanism situated on it to illustrate how the mechanism would be placed and a reference for size. The first plank, being the rear most plank, was intended to be installed for the Component Vending Machine. The other two were to represent the means for expansion when the first plank would run out of space for more delivery mechanisms. Drawings of the parts that made up the enclosure have been provided in \fullref{subsec:enctemplates} and \fullref{sec:request}. These were used to assist assembling the enclosure and will be discussed in more detail at a later stage of this report.

\subsection{Enclosure Redesign}
A redesign was needed for the enclosure, as problems were encountered when trying to manufacture the sloped plate illustrated in \autoref{fig:sloped}. The bending needed to be outsourced. The bending required was not feasible and so a small redesign of the enclosure was done.

	\begin{figure}[ht]	
	\centering
	\includegraphics[scale=0.3]{{redenclose}.jpg}
	\caption{Isometric view of the redesign. \label{fig:reenc}}
	\end{figure}
	
As can be seen in \autoref{fig:reenc} the initial sloped plate was replaced with the ``Simpler Sloped Plate". It would be feasible to bend this simpler plate with the tools at hand, eliminating the need to outsource the bending. In addition to changing the sloped plate, the front door was extended to reach the bucket at the bottom. The bucket was also widened to cater for the changed sloped plate. This redesign was done after the material that was ordered. No additional material was needed. The material ordered was adequate to complete the redesign.
\subsection{RFID Coil Cover}
A cover for the RFID reader was needed to protect the coils from damage that could be caused by the user. The cover was a simple design encasing just the coils and not the circuitry it connected to, as this would be situated behind the cover, inside the enclosure.

	\begin{figure}[ht]	
	\centering
	\includegraphics[scale=4]{{rfidhold}.jpg}
	\caption{Isometric back and front views of the RFID coil cover. \label{fig:rfid}}
	\end{figure}

The cover can be seen in \autoref{fig:rfid} from the rear and the front view. The cover was designed to be easily identifiable with the universal RFID symbol indented on the front of the cover, making it easy for the user to know where to swipe their card, illustrated by the item labelled ``Indent of RFID Icon". The cavity was designed to fit the coil with a bit of room for unpredictable coil measurements. This has been labelled ``Cavity for RFID Coil" in the figure. ``Cavity and hole for bolt" labelled above illustrates one of the cavities made for a bolt and washer to be situated to make the cover mountable on the casing of the enclosure. It was designed as such so that no bolt was visible on the front side making for a clean design for the user to see. A detailed drawing can be seen in \fullref{subsec:rfid}.

\subsection{PCB Design}
This section presents the designs that made the electronics of the Component Vending Machine. The PCBs designed in this section were made in Eagle CAD.

\subsubsection{Raspberry Pi HAT}
\label{subsubsec:rasppides}
The Raspberry Pi HAT was designed using measurements of the Raspberry Pi so that it would be able to fit on top of the Pi with standoff bolts allowing for a more compact design. A schematic of the circuit needed was initially designed in order to add the required components. This schematic can be seen in \fullref{subsec:pihat}.

	\begin{figure}[ht]	
	\centering
	\includegraphics[scale=4]{{PIHAT}.jpg}
	\caption{PCB layout of the Raspberry Pi HAT, top and bottom layer. \label{fig:pihat}}
	\end{figure}

The Raspberry Pi HATs main purpose was to be able to connect to the power supply and create a starting point for the power bus, as well as provide a way of connecting to the RS485 bus. The PCB layout has been illustrated in \autoref{fig:pihat}. In order to attach the ATX plug from the computer PSU to the Pi, a Molex socket was used that met the standards of the ATX plug. This connector has been labelled ``ATX" in the \autoref{fig:pihat}. The differential bus transceiver discussed in \autoref{subsec:bus} was used to facilitate the RS485 communication, labelled ``IC1". The receive signal was divided by a voltage divider, labelled ``R6" and ``R7", as the Raspberry Pis inputs were 3v3 tolerant. In addition to the main features, a switch was added to turn off the power supplied to the system from the computer PSU, labelled ``PWR". A switch for the door was also added so that the status of the door could be detected and has been labelled ``DOOR". Finally, a bank of resistors was added to stabilize the computer PSU by drawing 5W, tricking the PSU into thinking it was connected to a motherboard. These have been labelled ``R5" to ``R3".

\subsubsection{MCU Module}
The MCU module was originally designed to sit flat behind the delivery mechanism it was intended to control. It was later decided that it would be propped up vertically to help increase the density of the delivery mechanism that could fit in a meter length. The schematic was initially designed and can be seen in \fullref{subsec:mcu}.

The top and bottom layers of the PCB layout has been illustrated in \autoref{fig:mcumod}. The MCU external oscillator was placed first, followed by the DIP switch, ``SW1", and SN75176B placed to facilitate the basic operation and communications, ``IC1". Sensors and headers for the power communications and motors were then placed; ``GAPSNR1", ``GAPSNR2", ``VBRMTR", ``SERVO",  ``STEPPERMTR", ``PWR+COM1", ``PWR+COM2" and ``PROG". A potentiometer was placed at ``R13" to assist with calibration of the modules. Terminals for selecting calibration mode and connecting the trimpot were placed at ``MODE" and ``TRIM" respectively. In addition, 3 LED indicators were used in the bottom left corner showing green for power, red for MCU on and yellow for status. Holes were added to provide for mounting the board on standoff bolts.
	
	\begin{figure}[ht]	
	\centering
	\includegraphics[scale=3.8]{{mcumod}.jpg}
	\caption{PCB layout of the MCU module, top and bottom layer. \label{fig:mcumod}}
	\end{figure} 

\subsubsection{LCD Breakout Board}
An LCD breakout board was needed as it was later determined an LCD was to be used to give users feedback on the status of the dispensing session and other messages. The breakout board was designed because of the need to fit it to a board that it was not designed to fit on. The decision to use the LCD was made after the MCU module it was to be connected to, was sent for manufacturing. One of the MCU modules would be able to interface with the LCD breakout board because the initial design did not need a stepper motor, making them available for use for the LCD. A schematic of the LCD breakout board can be seen in \fullref{subsec:lcd}.

	\begin{figure}[ht]	
	\centering
	\includegraphics[scale=4]{{lcdboard}.jpg}
	\caption{LCD breakout board PCB layout, Bottom layer with silkscreen of top layer overlaid. \label{fig:lcd}}
	\end{figure}

The PCB layout of the LCD breakout board has been illustrated in \autoref{fig:lcd}. Unlike the previous two PCBs, the board was designed to fit on one layer. It was for this reason that the silkscreen was shown on the bottom layer to illustrate where components would be placed. The board was designed to fit under a 16x2 LCD module using standoff bolts. The LCD would be attached via the 16 way female header at the top of the board, labelled ``JP1". The back light was wired via tracks on the PCB. A trimpot, at ``R1", was attached to adjust the contrast ratio of the printed text on the LCD. A Molex header was used, at ``J1" to interface with the LCD with only the relevant pins being given a header pin with each one labelled on the tracks. This was done so that no silkscreen was needed to reduce manufacturing costs and simplifying the assembly. This simplification was designed to make it possible to make a homemade etched PCB. 

\subsection{Software Design}
This section will cover the design and basic testing of the software. This includes software on the microcontroller, the Raspberry Pi and the Website. First, an overview of the software design will be covered to provide an idea of how each program would interact with one another, followed by a discussion of the API before covering the actual software.

\subsubsection{Software overview}
The Component Vending Machine was designed to have a very clear and modular design, with each piece of hardware and software acting independently from one another. The reason for doing this was so that, if one module were to be swapped out for another, the whole system would not need to be redesigned. This would promote improvement and further development.
	
	\begin{figure}[ht]	
	\centering
	\includegraphics[scale=6]{{SystemOverview}.jpg}
	\caption{Overview of how each software element would interactr with one another. \label{fig:sysover}}
	\end{figure}
	
The \autoref{fig:sysover} illustrates the different modules and how they would interact for the purposes of this version of the Component Vending Machine. Users would order online using the website designed for the purpose of verifying the viability of an internet connected Component Vending Machine. This website would be hosted on a LAMP web server, hosted on the Raspberry Pi, allowing the website to interact with a database. The website would only have the ability to add or read entries in the database giving it limited control. In addition, a mail server would be used to generate administrators status updates, for example; Empty rails. Administrators would also have access to the website with elevated privileges allowing them complete control of the web server, website and database. This would allow administrators to edit who would be notified by the email system, update and manage the databases on the web server, website updates and edits as well as Master program updates.

The Master program would also be connected to the database. This way there would be no direct interaction between the website and the Master program, everything would run through the database. This would be a safer way of managing orders, as the database tool itself has protection for invalid entries. In addition to this, the Master program would have database management tools with elevated privileges, allowing the Master program to add, update, read and delete entries in the database. The Master program would also need to interact with the RFID reader and MCU modules. The routines on the Master Program would however only be invoked when there were a user interaction through the RFID reader. Once invoked, the Master program would communicate with the MCU module which would control the delivery mechanism. This module would be a low power solution, consuming very little power when idle. The MCU module would also report status updates back to the Master program.

\subsubsection{API}
\label{subsubsec:API}
In order for the Master program and MCU module program to communicate, an API was developed in order to maintain a reliable and trustworthy communications protocol. The API was defined for a package length of six bytes in total, from either master or slave, to keep it constant. The only time this deviated, was when the master would send LCD print data. The table below documents the API that was used to communicate between the Master and MCU programs:

		\begin{table}[ht]
			\centering
			\begin{tabular}{| m{3cm} | m{5cm}| m{5cm} |}
			\hline
			\multicolumn{3}{|c|}{\bfseries Master to Slave API (in Hexadecimal)}\\
			\hline
			\bfseries{Byte Number}  & \bfseries{Name/Description} & \bfseries{Values} \\
			\hline
			1$^{st}$ byte & Start Byte & 0xA1\\
			\hline
			2$^{nd}$ byte & Address Byte, of device to interface & 0x00 - 0xFF \\
			\hline
			3$^{rd}$ byte & Command Byte: {\begin{enumerate}[nosep]			
											\setlength{\itemsep}{0pt}
   											\setlength{\parskip}{0pt}
    										\setlength{\parsep}{0pt}  
											\item Call for Blank Response
											\item Dispense Components
											\item Free up Jammed Device
											\item Print on the LCD
										\end{enumerate}}	& Specific Values: \begin{enumerate}[nosep]	
																			\setlength{\itemsep}{0pt}
   																			\setlength{\parskip}{0pt}
    																		\setlength{\parsep}{0pt}	
																			\item 0xB1
																			\item 0xB3
																			\item 0xB5
																			\item 0xB7
																			\end{enumerate} \\
			\hline
			4$^{th}$ byte & Value Byte (no. pertaining to previous byte): \begin{enumerate}[nosep]	
																				\setlength{\itemsep}{0pt}
   																				\setlength{\parskip}{0pt}
    																			\setlength{\parsep}{0pt} 
																				\item No effect
																				\item Number of components to dispense
																				\item No effect
																				\item 4$^{th}$ byte to 3$^{rd}$ last byte would contain message to display on the LCD
																			\end{enumerate} & 0x00 - 0xFF \\
			\hline
			5$^{th}$ byte & Check Sum Value & Calculated using Bytes 1 to 4 \\
			\hline
			6$^{th}$ byte & End Byte & 0xF1 \\
			\hline
			\end{tabular}
			\caption{API used to communicate from master to slave. \label{tab:M2SAPI}}
		\end{table}
	\newpage
		\begin{table}[ht]
			\centering
			\begin{tabular}{| m{3cm} | m{5cm}| m{5cm} |}
			\hline
			\multicolumn{3}{|c|}{\bfseries Slave to Master API (in Hexadecimal)}\\
			\hline
			\bfseries{Byte Number}  & \bfseries{Name/Description} & \bfseries{Values} \\
			\hline
			1$^{st}$ byte & Start Byte & 0xD1\\
			\hline
			2$^{nd}$ byte & Address Byte, of device sending message & 0x00 - 0xFF\\
			\hline
			3$^{rd}$ byte & Report Byte:\begin{enumerate}[nosep]		
											\setlength{\itemsep}{0pt}
   											\setlength{\parskip}{0pt}
    										\setlength{\parsep}{0pt} 
											\item Jam in delivery mechanism
											\item Empty rail
											\item Low stock in rail
											\item Successful dispensary
										\end{enumerate} & Specific Values: \begin{enumerate}[nosep]	
																				\setlength{\itemsep}{0pt}
   																				\setlength{\parskip}{0pt}
    																			\setlength{\parsep}{0pt} 
																				\item 0xC1
																				\item 0xC2
																				\item 0xC4
																				\item 0xC8
																			\end{enumerate}\\
			\hline
			4$^{th}$ byte & Constant value & 0x01 \\
			\hline
			5$^{th}$ byte & Check Sum Value & Calculated using Bytes 1 to 4\\
			\hline
			6$^{th}$ byte & End Byte & 0xE1 \\
			\hline
			\end{tabular}
		\caption{API used to communicate from slave to master. \label{tab:S2MAPI}}
		\end{table}

The API was defined in such a way that it would be difficult for a corrupt message to be processed, ensuring only valid messages were used. The API would be set in place as an additional layer of security for the communication, in addition to the differential bus. The tables \autoref{tab:M2SAPI} and \autoref{tab:S2MAPI} can be used to replicate the protocol for any device intended to join the communication bus.

\subsubsection{Web design}
\label{subsubsec:webdev}

The website was designed using Sublime Text Editor with the framework, as researched in \autoref{subsec:litweb}, being the LAMP server. The majority of the content was designed with static HTML, with some PHP content embedded in the HTML. The overall design was produced to be user friendly and functional on most displays and browsers.

An image of the component store page can be seen at \fullref{subsec:weborders} and a picture of the contacts page can be seen at \fullref{subsec:contact}.

The website heading and cover layout were designed first. An image of basic components and the UCT logo were edited together to make a cover photo for the website and to represent the topic of the website. A menu bar was placed underneath this cover photo to allow for navigation on the website. In addition, a border was applied to the website to make it stand out. These three features were standard on each page of the website. The Website would consist of two pages; the component store page and the contacts page. The components store page began with basic instructions. Followed would be a design to fit three columns of components order forms, a number seen to work on most display sizes. The amount of rows would be determined by the amount of components needed on the store page. At the bottom of the component store page a text entry box, that would require a student number, with a submit button was placed. When the submit button were to be pressed the website would be directed to a PHP script that would check the order to make sure it did abides by the rules and correct it if needed. The script would then enter the data in to the database and give the user a small notification, in the form of a pop-up box, that the order had been processed and a breakdown of what the order contained. Then the user would be redirected back to the store page. The Contacts page was intended to simply allow users to contact the administrator with problems encountered with the Component Vending Machine or comments about improvements and additional features that could be implemented. It would contain an introductory message with an entry form below that would require; a name, student number, email address and message. A send button would be at the bottom of the form with which to submit the form. Once submitted the user would be redirected to a script that would send the relevant information in the form of an email to the administrator. Then the user would be redirected back to the contacts page.

\subsubsection{Raspberry Pi Master Program}

Both the Master program and MCU program were both designed in a modular fashion, in that most tasks were isolated into their own function, making it easier to adapt a certain function for alternative overall program functionality. This was done so that as the project progressed in the future, the software could be easily updated to adapt to future requirements.

Before discussing the program, the databases should be explained. Two tables were used in the database, one called ``Orders", for the orders that would to be placed on the Component Store page and another table called ``Components", for a record of the dispensary mechanisms in the Component Vending Machine, the component they dispense and the address they would be using. \autoref{tab:DB} shows all the variables that would be in each table and what they would be for.

		\begin{table}[!ht]
			\centering
			\begin{tabular}{| m{2cm} | m{2cm}| m{10cm} |}
			\hline 
			Name & Type & Description\\
			\hline
			\multicolumn{3}{|c|}{\bfseries Orders Table}\\
			\hline	
			StudentNo & String & The student number related to the order \\
			\hline
			PartName & String & The component name being ordered \\
			\hline
			Quantity & Integer & The number of components being ordered \\
			\hline			
			Date & Date & The date the order was placed \\
			\hline
			Done & Integer & A flag to indicate whether the order has been fulfilled or not\\
			\hline
			ID & Integer & A unique ID number given to each order\\
			\hline
			\multicolumn{3}{|c|}{\bfseries Components Table}\\
			\hline
			Address & Integer & The address related to a delivery mechanism \\
			\hline
			PartName & String & The name of the component, the address points to, dispenses \\
			\hline
			Jam & Integer & A flag to indicate a jammed or not at the address\\
			\hline
			Empty & Integer & A flag to indicate empty or not at the address\\
			\hline
			Low & Integer & A flag to indicate low or not at the address\\
			\hline
			\end{tabular}
		\caption{Database description of variables and what they are for. \label{tab:DB}}
		\end{table}

The Master program logic diagram can be seen in \autoref{fig:masterdiag}. The diagram shows a simplified view of how the Master program operates. The program began by checking the RFID reader for incoming data. The database was then queried with the RFID data to get the student number. Extra checks were done to check if an administrator were present. If so, a free-up command would be performed, resetting the empty and jam flags in the database and relevant modules. The orders relating to the student number would then be acquired from the database and dispensary requests would be sent to each relevant module one by one. Responses from each module would be received after each module had finished dispensing and the Master program would act accordingly.

The responses expected were; Jam, Empty, Low and Success. A Jam and Empty report would warrant the Master program to email an administrator advising the person to attend to the Component Vending Machine and the reason why. A Low and Success report would just update the relevant tables, but no email would be sent. All cases would give a report in the log. This will be discussed later in the report. 

This would be repeated until all orders, relating to the student/staff number that corresponded to the requested dispensary action, were done. The program would then return to an idle state and wait for a student card to read and receive RFID data that would then begin this process again.
\newpage
	\begin{figure}[!ht]	
	\centering
	\includegraphics[scale=1]{{statemachinemaster}.jpg}
	\caption{State machine diagram of the logic for the Master program. \label{fig:masterdiag}}
	\end{figure}
\newpage
In addition to the above loop, additional user feedback was provided in the program. Firstly, a log was kept of all the activities of the program and whether there were errors or successful operations. Secondly, LCD messages were transmitted to the first MCU module, which should have an LCD connected, to give the user swiping his/her student card feedback. Lastly, limits in the Master program software were put in place to limit the number of components ordered by any one person in one day.

\subsubsection{Microntroller Software}

The MCU program  logic diagram can be seen in \autoref{fig:mcustate}. Although the logic flow for the MCU module was fairly complicated and could be broken down into two sections; the initialization and integrity checks, then the main logic loop. The diagram only contains the main functionality of the modules program. Additional functions will be discussed briefly later. The state machine diagram for the MCU module and its software can be seen in \autoref{fig:mcustate}. In order to gain a better understanding of the diagram, key features were highlighted. Those not highlighted should be explained by the diagram itself. 

The MCU module program would start off with initialization. The initialization would entail setting up registers for the required inputs and outputs including PWM and ADC channels. Also, the Timers and UART channels would be setup. Lastly, the address of the module would be saved from the DIP switch meaning the address would only be recorded once. If the address were to be changed, the module would need a reset in order for it to take effect. Once initialized, the integrity checks would begin. The first check would be the ``Mode" check, which would determine whether the module should run the dispensary or the calibration task. If the calibration mode should be selected, the module would run through different angles on the servo motor for loading and dropping a component. The module would hold at each angle for a set period of time and the angle on the servo could be adjusted to match the delivery mechanism using the potentiometer. If in delivery mode, the module would run the dispensary task when requested via the UART communications over the RS485 bus. The module would idle in a low power state until serial data would be received. This low power state would release the angle on the servo by using a 0\% pwm and turning off the red and yellow LED. The check for jam or empty states would be done next, which would have been set, if a previous attempt at dispensing occurred in a jam or the tube on the delivery mechanism was empty. The only way to reset this flag would be by sending a free command from the master. Two other major checks needed explaining. The first being ``Is IC In Bucket", which would sample IR sensor on the bucket to determine if a component were in the bucket. The second would be the ``Is IC In Tube", which would sample the IR sensor on the IC Guide to determine if there were any components left in the tube. The last feature to be highlighted is the reporting and where ``Add" is used. This was highlights the fact that multiple reports can be sent simultaneously by using bit logic, where there were four report codes. The last four bits of the report code byte, represented one report code each.

Additional features, not covered in the diagram, were also made available for the module. These came into effect when a different command, than a ``Dispense" command, matched those in the API. The first would be a ``Call" command which would prompt the module to send a blank ``Success" report back. Next the ``Free" command would prompt the module to set the Jam flag back to default allowing the module to resume normal operation. The last being the ``LCD" command, which only applies to the module with the address 1, as it was intended that this module had an LCD connected to it. If an ``LCD" command were to be received, bytes 4 to the 3$^{rd}$ last byte would be the data that should be displayed on the LCD. The data received should be in ASCII format. The normal integrity checks would be applied for all the above to ensure no corruption could occurred.

The alpha version of this program was tested on a prototype setup using prototyping cables and electronic breadboard to simulate the PCB prior to assembly to verify its' functionality and to ensure it would not damage the PCB somehow. This was very successful and effective, as it helped debug various problems prior to having access to the PCB.

\newpage
	\begin{figure}[!ht]	
	\centering
	\includegraphics[scale=1]{{MCUStateDiagram}.jpg}
	\caption{State Machine Diagram for MCU software. \label{fig:mcustate}}
	\end{figure}
	\FloatBarrier
\newpage



	\begin{figure}[!ht]	
	\centering
	\includegraphics[scale=1.5]{{taskmanager}.jpg}
	\caption{A simplified logic diagram of the task manager and how it would function. \label{fig:taskman}}
	\end{figure}
	\FloatBarrier

One of the other features and specifications discussed in previous sections, was the minimal use of delays and a task manager to facilitate this. This would be designed using a timer that would be set to count up once every 1 millisecond. The design would be set to use a task counter and a conditional statement, based on the task counter, to facilitate invoking individual tasks. A task would entail an action that would occur without delays, for example when the sensors were to be sampled and the servo would be moved X\degree. After these actions would be taken, a short delay would be needed before the next action would be taken. In order to achieve this kind of task manager, a method was theorized and has been illustrated in \autoref{fig:taskman}. This method could be implemented for any number of tasks and would be implemented in the MCU module programming.
	
\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	%system assembly
\section{System Assembly}\thispagestyle{sectionstart}
This section will cover the assembly of the Component Vending Machine, from software, aspects which have not been covered yet, to assembling everything together. The Software assembly will be presented first, followed by the enclosure assembly. Once the enclosure assembly has been presented, the PCB and delivery mechanism assembly will be presented, one by one. Finally, a report of putting it all together will be presented. Where prices are quoted in the bill of materials, the prices were acquired from either RS components \cite{rsonline} or from the receipt from purchasing the material unless stated otherwise.

The priced quoted were up to date at the time this report was compiled and do not serve as a cost comparison for future assembly. Where pricing has not quoted the items were obtained from UCT from old or unused stock where the price was not readily available.

\subsection{Software Assembly: Server}

In order to host the website that had been designed in \autoref{subsubsec:webdev}, a LAMP server was installed on the Raspberry Pi.

An operating system needed to be installed on the Raspberry Pi before a LAMP server could be installed. The latest version of the Rasbian OS, a fork of the Debian OS, image was acquired from the official Raspberry Pi site \cite{raspbian}. The latest version of Win32DiskImager was then acquired, \cite{diskimage}, and used to mount the Raspbian image onto a Micro SD card. Once the process was complete the Micro SD card was mounted in the Raspberry Pi and the Pi was connected to the network with an internet connection, with a CAT5 cable. The IP address was obtained by searching the network for the Raspberry Pi. Once the IP was obtained, a terminal to SSH into the Pi was used. In this case, the program used was Putty.

Once the Pi was powered and running, the installation of the LAMP server could begin. A detailed log of commands used to make this possible, has been included in \fullref{sec:PiCommands}. The databases for the repositories was initially updated along with the software on the Pi itself. The LAMP server was then installed along with the required mail server for administrative notifications. The plugins for the Master program was then installed, along with registering the Master program to run on boot.

The bill of materials for the serer can be seen in \autoref{tab:bomserv}. All the materials for the server
 were provided by UCT.
 
	\begin{table}[ht]
	\centering		
	\begin{tabular}{| m{8cm} | m{4cm}| m{3cm} |}
	\hline
	\textbf{Part Name} & \textbf{Cost} & \textbf{Quantity} \\
	\hline
	Raspberry Pi & R 636.51 * & 1\\
	\hline
	Micro SD Card (Class 10) & R 108.95 * & 1 \\
	\hline
	\end{tabular}
	
	 * Obtained from UCT
	\caption{Bill of materials for the Server. \label{tab:bomserv}}
	\end{table}	
\subsection{Enclosure Assembly}
The enclosure assembly followed the design using drawings from \fullref{sec:request} and \fullref{subsec:enctemplates} to guide the process. Initially, materials were ordered, aluminium and steal L and flat bars. The orders were placed through UCT to known suppliers that had working relationships with UCT. Assembly of the enclosure began with cutting the steel L and flat bars to length for the frame only. The frame was then welded using stick welding. Initially the the base and top of the frame were welded, then the columns in the corners. The walls of the frame, made of 2mm aluminium sheets, were then cut using a guillotine. The walls were clamped to the frame and holes were drilled through the walls and the frame. The walls were drilled one by one until the 4 walls, 2 sides back and top, were all drilled and attached using bolts for removal if needed. A picture of the enclosure at this stage of the build can be seen in \autoref{fig:enfrwal}.

	\begin{figure}[!ht]	
	\centering
	\includegraphics[scale=0.15]{{enfrwal}.jpg}
	\caption{Pictures of the enclosure frame with the walls bolted on. \label{fig:enfrwal}}
	\end{figure}

Holes and openings were drilled in the front door plate and rear plate to accommodate the PSU, Ethernet cable, LCD and RFID cover. The next step was to bend the drop plate using a bending press. The height of the drop plate was marked inside the frame and the piece to hold the wooden shelves was welded onto the frame. A strip, which would hold up the shelves, was also welded onto these pieces to bolt the drop plate in place. The drop plate and frame were drilled and bolts were placed to secure it in place. The front door panel was placed on the frame and marked with the hinges in place. Holes for the hinges in the frame and aluminium were drilled and the hinges were secured with countersunk bolts and nuts. The next procedure was to drill the holes for the lock. The lock was then attached with countersunk bolts and nuts. A picture of the enclosure at this stage of the build can be seen in \autoref{fig:endone}. All the materials used are listed in the \autoref{tab:bomen}. The enclosure had final dimension of width, length and height on top as follows; 605x1098x1300, and width and length on the bottom as follows; 705x1098

	\begin{figure}[!ht]	
	\centering
	\includegraphics[scale=0.22]{{enfin}.jpg}
	\caption{Pictures of the enclosure frame with all the internal elements in place. \label{fig:endone}}
	\end{figure}
	\FloatBarrier

Additionally, a small plate was fashioned in order to mount the Raspberry Pi perpendicular to the rear wall instead of against it to allow for the Ethernet port to be exposed from the back. This was not specified in the design but was added to reduce additional costs to allow for the Raspberry Pi to connect to the internet via CAT5 cable. A piece of wood was cut, from a sheet of compressed chip board, for the shelf and was included in the overall assembly of the project. This piece of wood was specified in the designs with width, height and length as follows; 1077x128x12 (mm).

	\begin{table}[ht]
	\centering		
	\begin{tabular}{| m{8cm} | m{4cm}| m{3cm} |}
	\hline
	\textbf{Part Name} & \textbf{Cost} & \textbf{Quantity} \\
	\hline
	Steal Bar & R 19.67 *** & 1 \\
	\hline
	Steal L bar & R 162.51 & 1 \\
	\hline	
	Aluminium sheets & R 1549.2 *** & 1 \\
	\hline	
	M6 bolts and nuts & R * & 42 \\
	\hline
	M5 bolts and nuts & R * & 8 \\
	\hline
	M4 bolt, nuts and washers & R & 12\\	
	\hline
	Wood & R * & 1\\
	\hline	
	Flush Aluminium hinge x 2 & R 77.00 ** & 1 \\
	\hline
	Hasplock 75mm & R 81.00 ** & 1 \\
	\hline
	\end{tabular}
	
	 * Obtained from UCT
	 ** Obtained from a hardware store
	 *** Estimated from the amount of material used and that ordered through UCT.
	\caption{Bill of materials for the enclosure. \label{tab:bomen}}
	\end{table}	

\subsection{PCB Assembly}
Multiple PCBs were assembled, the process of this assembly for the Pi HAT, MCU module and LCD breakout board have been documented below. The PiHAT and MCU module PCB were manufactured through Trax. As most of the components selected were selected for the reason that they would be readily available at UCT, the acquisition of all the components was quick. This made assembly begin as soon as PCBs arrived while also reducing the external costs of the project.

\subsubsection{Pi HAT}

Once all parts had been acquired, the assembly of the Pi HAT began. First, the ATX connector was soldered on and the voltages on important pins, like the power pin for the Raspberry Pi, were measured with the power supply plugged in. After the correct voltage levels were observed, the remaining components were soldered as specified in the design in \autoref{subsubsec:rasppides}. A Picture of the finished PCB can be seen in \autoref{fig:pihatpcb}. As can be seen in the picture, some components were not soldered as they were not necessary. The 120 $\Omega$ termination resistor was left out as the communications worked without it. The power resistors, R3 to R5, were left out as the PSU worked without them. These resistors were a precaution in case the PSU needed to be tricked to supply a regulated voltage. A bill of materials for the PCB has been listed in \autoref{tab:bompi}, including those excluded from the build for the purpose of this report.
	
	\begin{figure}[!ht]	
	\centering
	\includegraphics[scale=0.3]{{pihatpcb}.jpg}
	\caption{Pictures of the PiHAT PCB by istelf, on the left, on the Raspberry Pi, on the right. \label{fig:pihatpcb}}
	\end{figure}

	\begin{table}[ht]
	\centering		
	\begin{tabular}{| m{8cm} | m{4cm}| m{3cm} |}
	\hline
	\textbf{Part Name} & \textbf{Cost  (Unit Cost)} & \textbf{Quantity} \\
	\hline
	PCB & R * & 1 \\
	\hline
	Molex MINI-FIT JR. Series 5556 20 way & R 18.30 & 1 \\
	\hline
	SN75176B & R 8.97 & 1 \\
	\hline
	6 way 2.54mm header friction lock & R 3.64 * & 1 \\
	\hline
	Red LED 1206 & R 0.94 & 1 \\
	\hline
	805 150$\Omega$ & R 0.94 * & 1 \\
	\hline
	20 way 2.54mm socket & R 22.71 * & 1 \\
	\hline
	M3 metal standoff & R 5.40 (R 1.80) & 3 \\
	\hline
	Reed switch & R * & 1 \\
	\hline
	SPST Rocker Switch & R 6.13 & 1\\
	\hline
	805 120$\Omega$ & R 0.94 * & 1 \\
	\hline
	Axial Resistor 15 $\Omega$ 2W & R 5.76 (R 1.92) & 3 \\
	\hline
	\end{tabular}
	
	 * Obtained from UCT
	\caption{Bill of materials for the Pi HAT. \label{tab:bompi}}
	\end{table}	
	\FloatBarrier
	
\subsubsection{MCU Module}
\label{subsubsec:mcuassemble}
The assembly began with soldering the the STM32F0 microcontroller. The IC was then tested for heat or static damage by connecting it to power without any programming or external oscillator. Next, the external 8Mhz oscillator was attached with the stabilizing capacitors. Again, the microcontroller was tested and the code was uploaded to test proper operation. After successful tests were run, the remainder of the components were soldered to complete the PCB. Six MCU module boards were ordered in total. Initially, three were soldered for testing purposes and for further debugging of the code. The idea was to test the code with more than one module on the system, to check for irregularities and problems with the code, as only one prototype on the system had been tested prior to assembly.

There were two configurations made. One for the primary device at address 1 with an LCD and 2 without the LCD plugins. The plugins entailed a 4 way terminal on the ``EN", ``MS1", ``MS2", ``MS3" through holes and a two way terminal for the ``STEP" and``DIR" through hole. Those through holes mentioned related to the stepper module for future expansion and yet to be designed delivery mechanisms. A picture of both versions built for this report can be seen in \autoref{fig:mcumodpcb}. A complete bill of materials can be seen in \autoref{tab:bommcu}. The remaining three PCBs were soldered once the code worked reliably with more than one MCU module on the bus. They were assembled as stated above.
\setlength{\textfloatsep}{5pt}
	\begin{figure}[!ht]	
	\centering
	\includegraphics[scale=0.32]{{mcumodpcb}.jpg}
	\caption{Pictures of the MCU module PCB, with the LCD plugin on the left, without the pcb plugin on the right. \label{fig:mcumodpcb}}
	\end{figure}
	\begin{table}[ht]
	\centering		
	\begin{tabular}{| m{8cm} | m{4cm}| m{3cm} |}
	\hline
	\textbf{Part Name} & \textbf{Cost  (Unit Cost)} & \textbf{Quantity} \\
	\hline
	PCB & R * & 1 \\
	\hline
	STM32F051C6 & R 34.64 * & 1 \\
	\hline
	SN75176B & R 8.97 & 1 \\
	\hline
	8MHZ HC-49 SMD & R 4.36 * & 1 \\
	\hline
	805 10pf & R 0.34 (R 0.17) *  & 2 \\
	\hline
	805 1M$\Omega$ & R 0.94 * & 1 \\
	\hline
	General Purpose Diode SOD80 SMD & R 0.42 & 1 \\ 
	\hline
	NPN 200ma rating SOT23 & R 2.05 * & 1\\
	\hline
	DIP Switch & R 7.70 & 1 \\
	\hline
	805 120$\Omega$ & R3.76 (R 0.94) * & 4 \\
	\hline
	805 150$\Omega$ & R 1.88 (R 0.94) * & 2 \\
	\hline
	Red LED 1206 & R 0.94 & 1 \\
	\hline
	Green LED 1206 & R 0.98 & 1 \\
	\hline
	Yellow LED 1206 & R 1.04 & 1 \\
	\hline
	805 3K6$\Omega$ & R 0.94 * & 1 \\
	\hline
	805 2K $\Omega$ & R 2.82 (R 0.94) * & 3 \\
	\hline
	805 1K$\Omega$ & R 2.82 (R 0.94) * & 3 \\
	\hline
	805 10K$\Omega$ & R 2.82 (R 0.94) * & 3 \\
	\hline
	3 way 2.54mm header & R 0.51 * & 1 \\
	\hline
	4 way 2.54mm header friction lock & R 4.84 (R 2.42) * & 2 \\
	\hline
	6 way 2.54mm header friction lock & R 10.92 (R 3.64) * & 3 \\
	\hline
	2 way 2.54mm header & R 0.38 * & 1 \\
	\hline
	5K$\Omega$ Potentiometerv & R 5.40 * & 1 \\
	\hline
	M3 metal standoff & R 5.40 (R 1.80) & 3 \\
	\hline
	805 75$\Omega$ & R 1.88 (R 0.94) * & 2 \\ 
	\hline
	  
	\end{tabular}
	
	 * Obtained from UCT
	\caption{Bill of materials for the MCU module. \label{tab:bommcu}}
	\end{table}	
	\vfill
	\FloatBarrier
\newpage
\subsubsection{LCD Breakout Board}
The LCD breakout board was made using a method called the Toner Transfer Method. This method required very little resources and could be done without professional equipment reducing the manufacturing cost of PCB making. 

	\begin{figure}[!ht]	
	\centering
	\includegraphics[scale=0.48]{{lcdbreakassem}.jpg}
	\caption{Pictures from the etching proccess to make the LCD breakout baord. \label{fig:lcdassem}}
	\end{figure}

The \autoref{fig:lcdassem} illustrates the assembly process at various stages of the process. First, the PCB layout was printed on photo quality paper using a laser printer. This print was cut out and placed on the piece of copper clad to be etched (a). The print was then transferred onto the copper using an iron, the result of this transfer can be seen in (b). Next, the board was placed in a solution of Ferric Chloride and a small amount of water. Left for a period of time, the copper was dissolved and the result can be seen in (d). The toner was then removed using 1000 grit sandpaper and holes were drilled where needed. The board was then painted with UV treated solder mask which can be seen in (e). Finally, the board was cut to size and the components were soldered on (f). A bill of materials can be seen in \autoref{tab:bomlcd}. 

	\begin{table}[ht]
	\centering		
	\begin{tabular}{| m{8cm} | m{4cm}| m{3cm} |}
	\hline
	\textbf{Part Name} & \textbf{Cost (Unit Cost)} & \textbf{Quantity} \\
	\hline
	20cm$^2$ of copper clad & R 6.96 & 1 \\
	\hline
	16 way 2.54mm PCB Socket & R 15.15 & 1\\
	\hline
	16x2 Topway LCD (LMB162ABC) & R 98.86 * & 1 \\
	\hline
	1K Trimmer Potentiometer & R 6.75 & 1 \\
	\hline
	220uf Capacitor & R 4.08 & 1 \\
	\hline
	8 way Molex & R 9.35 & 1 \\
	\hline	
	M3 metal standoff & R 3.60 (R 1.80) & 2 \\
	\hline
	\end{tabular}
	
	* Obtained from UCT
	\caption{Bill of materials for the LCD breakout board. \label{tab:bomlcd}}
	\end{table}	

\subsection{Delivery Mechanism Assembly}
\label{subsec:deliveryassembly}
The acrylic glass was ordered to begin assembly of a delivery mechanism. The acrylic glass was cut as per one of the templates in \fullref{subsec:templates}. The roller and IC guide were 3D printed using PLA. Once all the parts had been acquired, assembly could begin.
	
Bolts and washers were placed in the designated holes. The next step was to solder wire leads onto the IR LEDs and phototransistors. A pair of IR LED and phototransitor, with wire leads, were glued into the designated slots making sure to line them up with the intended component to minimize false readings. The sensors were lined up in the IC guide by placing a tube in the guide and placing components in the tube to determine the optimal slot, of three, to use. The Vibration motor was then placed inside the cavity made for it and leads soldered to it. Finally, the servo horn was lined up with the foothold. A small amount of glue was used to secure it. The finished product for one of the IC guide and roller can be seen in \autoref{fig:3Dprints}.

	\begin{figure}[!ht]	
	\centering
	\includegraphics[scale=7]{{3dprintsv2}.jpg}
	\caption{Picture of the 3D printed IC guide and roller after assembly. \label{fig:3Dprints}}
	\end{figure}

The housing structure was assembled next. The structure was assembled according to the design and drawings in \fullref{subsec:h3} using Tensol adhesive to secure the structure. The servo motor was placed inside the housing structure during assembly. The 3D prints that were assembled and described above were then fixed to the housing structure with bolts, nuts and a screw for the servo horn. Sockets were attached to the end of the leads to enable them to be connected to the MCU modules. The final product of this assembly can be seen in \autoref{fig:housing}. In total, six delivery mechanisms were assembled, one for each design.

	\begin{figure}[!ht]	
	\centering
	\includegraphics[scale=7]{{delivassem}.jpg}
	\caption{Picture of the housing structure for the delivery mechanism. \label{fig:housing}}
	\end{figure}

	\begin{table}[ht]
	\centering		
	\begin{tabular}{| m{8cm} | m{4cm}| m{3cm} |}
	\hline
	\textbf{Part Name} & \textbf{Cost} & \textbf{Quantity} \\
	\hline
	acrylic glass 311.85cm$^2$ & R * & 1 \\
	\hline
	3D Printed parts & ~R 20.00 ** & 1 \\
	\hline
	IR LED + Phototransistor sensor & R * & 2 \\
	\hline
	M4 bolt and nut & R * & 4 \\
	\hline 
	M4 washer & R * & 4 \\
	\hline	
	M3 bolt & R * & 2 \\
	\hline
	DS-339MG Digital servo & \euro{} 8.04 *** & 1 \\
	\hline
	\end{tabular}
	
	 * Obtained from UCT
	 ** Estimated by weight
	 *** Pricing from Hobby King, Obtained from UCT
	\caption{Bill of Materials for the delivery mechanism. \label{tab:bomdel}}
	\end{table}	

\subsection{Overall Assembly}
\label{subsec:finbuild}
Once all individual modules and the enclosure had been assembled, the final product of the research could be assembled. This section will present the methods used to assemble all the components of the project together to complete the Component Vending Machine.

Initially, the shelves for all the delivery mechanisms were prepared. A drill template, which can be seen in \fullref{subsec:drilltemp}, was made in order to make holes for mounting each delivery mechanism. Included in this template is a template for the size of the a wooden plate that would serve to hold the PCB vertically on the plank. This was done, as specified in the design, to increase the density of the delivery mechanisms allowed on one shelf. Using this template, holes were drilled in the plank and plates were cut from the same wood the shelf was. Holes were drilled in the wooden plates, using the PCBs as a template, to mount the PCBs using metal standoffs. Once all the necessary holes were drilled, the six assembled delivery mechanisms were attached using M4 bolts, washers and nuts. The leads for the motors and sensors were cut and fitted to sockets so they could attach to the PCBs. A test PCB was made to help with wiring of the sensors to correspond with the terminal on the PCB, a picture of its schematic and physical realization can be seen in \autoref{fig:tester}.

	\begin{figure}[!ht]	
	\centering
	\includegraphics[scale=0.2]{{tester}.jpg}
	\caption{Picture of the sensor tester circuit schematic on the left and the physical circuit on the right. \label{fig:tester}}
	\end{figure}

Once all the connectors had been attached, the PCBs were attached to the plates and the plates were screwed on perpendicularly to the shelf using wood screws. This allowed them to be stacked one behind the other. Wires were made to connect the PCBs together in a linear fashion, ie daisy chaining from one to the next. A picture of the shelf with all the delivery mechanism and PCBs in place can be seen in \autoref{fig:shelf}.

	\begin{figure}[!ht]	
	\centering
	\includegraphics[scale=3.5]{{shelfinal}.jpg}
	\caption{Picture from the rear of the shelf, top image, and the front, bottom image. \label{fig:shelf}}
	\end{figure}
	\FloatBarrier

Next the cover for the RFID tag reader antenna was assembled using the template in \fullref{sec:request}, sheet number 6 and 7. The bottom plate and middle plate were glued together first. Then bolts were placed in the cavity, through the designed holes. The antenna was then placed in the center of the middle plate and the top plate was glued in place to hold the antenna and bolts in the cover. This was left to set and a picture of the finished product can be seen in \autoref{fig:rfidcover}.

	\begin{figure}[!ht]	
	\centering
	\includegraphics[scale=0.2]{{rfidcover}.jpg}
	\caption{Picture of the back and front of the RFID antenna cover. \label{fig:rfidcover}}
	\end{figure}
	
The RFID cover and LCD module were then mounted on the Front panel door with bolts and nuts to hold them in place. A wire for the LCD module was fashioned with sockets that would enable it to connect to the first MCU module. The RFID module was connected to the antenna and a USB cable was connected and secured to the case with epoxy to prevent it from detaching. The Raspberry Pi and computer PSU were attached next. The Raspberry Pi was attached the the small sheet that put it perpendicular to the rear wall and the PSU attached directly to the rear wall using screws. The PSU was connected to the Pi HAT and the USB from the RFID cover was attached to the Raspberry Pi. The power switch for the Pi HAT was mounted in the wall and the terminals were soldered. The magnetic switch for the Pi HAT was mounted on the frame of the door using double sided tape. Wires were attached from the Pi HAT to the magnetic switch. The shelf, holding all the delivery mechanisms, were placed on the shelf holder in the enclosure and wired to the Pi HAT.
	
\subsection{Additional Notes and Final Assembly}
This section will serve to present implementations that were not in the designs. 

The sensors for the DIP 20 IC socket were giving false readings during testing and it was found that the components were falling too low. This was only a problem for the DIP holder of the DIP 20 specifically, as it had a slot in the middle of the component which allowed light to shine through. To help mitigate false readings, a small slice of acrylic glass was sanded down to place under the bucket when loading components. This helped mitigate false readings. The same was done for the DIP 20 IC dispenser as, it was the most unreliable dispenser. The unreliability of this dispenser will be discussed further in \autoref{subsec:fintest}.

A handle was placed on the door of the enclosure to give an alternative for people pulling on the lock and possibly breaking it. This was done due to the door sagging on the open end, meaning the door needed to be propped up. This was done by placing two holes in the door, and two bolts on the frame which the holes in the door would be propped on to prevent it from sagging when closed.

Finally, the enclosure was painted as can be seen in the pictures of the final assembly. The enclosure door was removed along with the lock, hinges and handle. All the internal components were also removed before painting. Newspaper was layed out on the floor in a well ventilated room. All the walls and the door of the enclosure were spray painted. A layer of primer was first applied to the panels followed by a coating of glossy black. Once all sides were completed, the door was reassembled, with the LCD, RFID cover and module, lock, handle and hinges. The door was then fitted to the frame to make the enclosure. Finally, wires for the LCD module to connect to the first MCU module, the magnetic switch and the Pi HAT to connect to the MCU modules were fashioned.

The final product can be seen in \autoref{fig:finalassem}, \autoref{fig:finalint} and \autoref{fig:finalpi}.

	\begin{figure}[!ht]	
	\centering
	\includegraphics[scale=0.23]{{finassem1}.jpg}
	\caption{Picture of the finished Component Vending Machine from the back, front and with the door open. \label{fig:finalassem}}
	\end{figure}	
	
	\begin{figure}[!ht]	
	\centering
	\includegraphics[scale=4.4]{{finalinternal}.jpg}
	\caption{Labelled picture of the interior of the Component Vending Machine and its components. \label{fig:finalint}}
	\end{figure}
	
	\begin{figure}[!ht]	
	\centering
	\includegraphics[scale=4]{{finpipic}.jpg}
	\caption{Labelled picture of the Raspberry Pi and PSU situated behind the sloped plate and below the wooden shelf. \label{fig:finalpi}}
	\end{figure}
	\FloatBarrier

\textcolor{white}{.}

\newpage


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	%build review, results and disussion
\section{Results and Discussion}\thispagestyle{sectionstart}
Results from various tests were recorded during the process of the project. Some results have been stated previously, but will be discussed in more detail in this section. The three major categories of tests were; Prototyping tests, Comparison test and finally, Final build stress tests. These tests and results will be presented in this section. Also included in this section, will be results from tests done on the communications and final operations test results with the full system assembled.

\subsection{Prototyping Tests}

The prototyping tests were done in order to validate the design to make sure it was a viable design. This was done to ensure an ineffective design was not used for the final build. The tests were structured in a way to produce comparable results. Each Dispensary test was done with 100 or more individual dispenses to produce a sample to grade the reliability of the design. The actions that were recorded were; a ``Success" meant the dispensary action completed without an error, a ``Half Load Error" which meant the component to be dispensed caught on the lip of the bucket, a ``Full Load Error" meant the component to be dispensed caught halfway down the bucket while loadin and a ``Release Error" meant the component to be dispensed was caught in the bucket while trying to release. The results can be seen in \autoref{fig:prototest}. Videos of the tests can be seen at \cite{verttest1p1,verttest1p2,vertv2,newhor}, or on the accompanying CD named ``Video 1", ``Video 2", ``Video 3" and ``Video 4".

	\begin{figure}[!ht]	
	\centering
	\includegraphics[scale=4]{{prototest}.jpg}
	\caption{Graph showing the results of the protoyping tests done during the design phase of the project. \label{fig:prototest}}
	\end{figure}
	
Comparing results, one can see that with each version of the roller, the reliability rating improved until it met the required 95\% rating or above. A major failure in the earliest version of the roller was the full load error. This was a catastrophic failure which caused concern as it could damage components and was present in both versions of the vertical roller. Even with sensors, this problem was present, due to the design of the roller. This error was mitigated in the horizontal roller while also greatly reducing the chance of other failure modes, leading to the choice in using it as the final design.

\subsection{Comparison test}
A comparison test was done to compare the reliability of the horizontal roller with a vibration motor and without a vibration motor. This was done to validate the use of a vibration motor to assist loading and releasing of components in the bucket. Each test consisted of 105 individual dispenses to get a rough sample of the reliability under each circumstance. The same actions as the prototype testing were used to determine failure modes. The idea was that a vibration motor would help increase the reliability rating of the delivery mechanism. This test was set out to test this theory. The results of the test can be seen \autoref{fig:comptest}. A video of the test can be seen at \cite{horvbr,hornovbr}, or on the accompanying CD names ``Video 7" and ``Video 8".

	\begin{figure}[!ht]	
	\centering
	\includegraphics[scale=4]{{comptest}.jpg}
	\caption{Graph showing the results of the protoyping tests done to compare the reliability rating with and without a vibration motor. \label{fig:comptest}}
	\end{figure}
		
As can be seen in the graph, the test with the vibration motor was more reliable than without a vibration motor, as expected. The vibration motor helped with loading and releasing, increasing the reliability to 100\%. This resulted in the design on the delivery mechanism to be concluded, as it proved the design was successful.

\subsection{Final Build Stress Tests}
\label{subsec:fintest}
Stress tests were done on the assembled delivery mechanism to validate that they worked as intended. The test was set up to be repeatable on future delivery mechanisms to validate them before deployment. The tests entailed 20 rounds of 10 components dispensed per round. This amounted to a total of 200 individual dispenses. This was done in order to thoroughly test assembled delivery mechanisms before they were deployed in the White Lab Component Vending Machine. The MCU board was programmed to reduce external errors by dispensing all 10 components with a manual switch of the eighth address bit on the DIP switch. Only three failure modes were recorded, as a half load was no longer a focus of the test. The actions recorded were; a ``Success" which meant the dispensary action was completed without an error, a ``Load Error" which meant the component to be dispensed failed to fall in the bucket properly, a ``Release Error" which meant the component to be dispensed  failed to vacate from the bucket when being released. The results from the test done on the assembled delivery mechanism can be seen in \autoref{fig:fintest}. A time-lapse video of the testing can be seen at \cite{stresstest}, or on the accompanying CD named ``Video 9". 

	\begin{figure}[!ht]	
	\centering
	\includegraphics[scale=4]{{finaltest}.jpg}
	\caption{Graph showing the results of the stress tests done on all the assembled delivery mechanism for the final build. \label{fig:fintest}}
	\end{figure}
	\FloatBarrier

As can be seen in the results, all the delivery mechanisms displayed a reliability rating that exceeded expectations and requirements. All achieved a reliability rating of 100\% with the exception of the DIP 20 delivery mechanism, with a rating of 99\%. The 99\% reliability rating of the DIP 20 delivery mechanism was due to the height of the bucket and the component, to be loaded in the next cycle, catching on the filleted slope of the bucket. 

\subsection{Communications testing}
The communications between the devices was tested thoroughly to make sure the system would not fail because of a communications error. While prototyping, tests were done on communications to observe noise on the transmission lines. When using all sensors and motors, the system produced enough noise to corrupt the data when standard UART was used. Take note of \autoref{fig:noise}. The image was captured from a logic analyzers output after being connected to the transmission lines and observing the data over the lines.

	\begin{figure}[!ht]	
	\centering
	\includegraphics[scale=0.44]{{CommonNoise1}.jpg}
	\caption{Common mode noise observed on the transmission lines. \label{fig:noise}}
	\end{figure}
	
One can see a message was sent in between the 1 second and 2 second mark in this picture. Another message can be seen in between the 2 second and 3 second mark. This was the expected result. In between the 3 second mark and the 4 second mark, there were abnormal spikes on the transmission line corrupting the data, preventing proper communications. This test was done after communications failed during prototyping leading to the expected need for a more reliable communications protocol. 

Test were done with the RS 485 bus transceiver chip and the communications worked as expected. There were problems with communication, but it was found that the limitations of the Raspberry Pi and its' ability to interact with the RS 485 bus transceiver. This was found during debugging of the final assembly. It was isolated to the Raspberry Pi, by testing communications with the MCU modules alone and they were able to communicate with each other flawlessly. After further debugging, a solution was found by changing the way the code interacted with the RS 485 chip, allowing for reliable communications.

\subsection{Final build Results and Discussion}
The final build as detailed in \autoref{subsec:finbuild} was tested to make sure it operated as expected. The tests that were done, were repeated orders and dispensary requests. After some debugging, it was found that one of the MCU modules were faulty and was taken off the chain. This proved to fix functionality enabling the device to operate properly. Although there were some changes needed to the code base in order to make this so, this was mainly due to problems with communications handling. After these issues were fixed, the Component Vending Machine operated as expected. An excerpt of the log of the Master Program can be seen in \fullref{sec:maslog}. This log shows majority successful dispensary actions with some corrupted communication warnings. The corrected code accounted for these unsuccessful communication attempts by attempting to resend the message which would then successfully complete the dispensary action. A video corresponding to this log can be seen at \cite{fintest} or on the CD that accompanied this report called ``Video 10" along with the log file named ``Master.log"
\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	%conclusion
\section{Conclusion}\thispagestyle{sectionstart}
The aim of this research and report was to investigate the possibility of fabricating a White Lab Component Vending Machine. Designs and construction requirements were set out to define what the Component Vending Machine needed to do and how it should be done. The function of the Component Vending Machine was the reliable dispensing of individual components so as to deliver a 24 hour 7 days a week, store that students could request components from. The system needed to be able to identify students by reading their student cards and interacting with an online store. This was so that students could easily interact with the Component Vending Machine at any time of the day or night. Finally, an enclosure was designed that would be able to house all the parts that made up the internals of the Component Vending Machine while being able to present the components to the students ordering the components.

Designs were theorized and prototypes were made for each version of the design, until an optimal solution was found. The amendments over each version of the delivery mechanism were due to flaws found in the prototypes, which lead to a reliable final design. Additionally, an enclosure and PCBs were designed to work in tandem with the delivery mechanisms. Code was then designed to work on the aforementioned PCBs that would help operate the delivery mechanism and facilitate an internet connected device. After the designs were completed for the White Lab Component Vending Machine, assembly began.The assembly of the Component Vending Machine was successful for the most part with some challenges and failures. In the end, a viable device was produced for further testing. 

The enclosure worked for its intended purpose. However, there were inaccuracies due to lack of skill and proper tools. Although it was not the expected outcome, the enclosure was successful enough to house all the parts needed, allowing for a working prototype that could be deployed in the White Lab.

The website functioned as expected and helped to prove the internet capability and that such a device was more than capable of connecting to the internet. This meant that the Component Vending Machine would be able to operate with a single input from the student once they had placed their orders, making it simple and easy to use. This input would be the swipe of their student cards. 

With the ability to stock the machine with the component tubes, the machine would be able to stock a large quantity of components. This meant it would be able to supply students with components for extended periods of time without needing to be restocked. This also meant that the machine would be able to supply students with components overnight and reduced the possibility that it would run out of stock on any given night. If it did run out of stock, it would not be a common occurrence due to the quantity of stock the machine was capable of supplying.

The delivery mechanisms all worked better than expected, exceeding the set out reliability standard. Although the delivery mechanisms themselves were successful, the MCU modules were not all functional. This was due to problems encountered in the assembly and not the design. This meant that the design of the MCU module was successful and met the requirements set out at the beginning of the project. With the Pi HAT also working, along with all of the above, the basic functionality of the Component Vending Machine was successful. On top of this success, the Component Vending Machine was able to communicate over the internet and interact with the website to enable online ordering. Paired with the RFID tag reader, the system was able to identify student numbers and match them to orders that were placed on the online store. After matching student numbers with orders on the store, components were successfully delivered to the aforementioned student. The design worked for the intended purpose and therefore, was a successful design and implementation of the White Lab Component Vending Machine.

\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	%recommendations
\section{Recommendations}\thispagestyle{sectionstart}
Although the Component Vending Machine worked as intended, there were some potential enhancements identified. The recommendations focus mainly on the build and what could be improved, after experience with assembling the Component Vending Machine. Comments on process and future implementations will also be made and are presented in this final section.

As seen in the research, Apache is fast becoming an outdated software package, with Nginx set to take the lead. This should be taken into consideration. Even though the Component Vending Machine was not expected to have a lot of traffic on the website, future demands may justify a shift to Nginx. Also, support for Apache may be reduced in the future, as Nginx gains popularity, in which case the server should be migrated to a Nginx web server. 

Although The website achieved its purpose, when compared to more commercial websites it lacked many features. It was not easily upgradeable and so would reach a point where the website would be unable to meet the requirements of the Component Vending Machine. The website also lacked proper administrator tools, restricting control. It should be heavily upgraded by someone with extensive knowledge in web development. The other alternative was to use a completely different website and integrate the Component Vending Machine with such a website, which would be more capable of meeting student requirements and expansion of the Component Vending Machine and its catalogue.

A mistake was made when soldering the sensor headers on the PCBs and to keep the format of the PCBs uniform, this mistake was replicated. It did not change the functionality of the PCBs, but may cause confusion for future installers when looking at pictures. Future builds should follow the designs to reduce the possibility of mistakes that could cause damage to the sensors or PCB.

The DIP 20 IC and IC socket dispensers were the most unreliable and problematic dispensers. A fix for the issue was implemented but was not practical. The root cause for the IC dispenser was the height of the roller bucket. The bucket was too high, causing the IC to be loaded on the next round to jam up against the filleted slope as discussed in the testing. A redesign should be undertaken with follow up tests. A small height adjustment to the bucket should fix the issue. The IC socket dispenser was getting false readings due to the slightly elevated sensor position in the bucket. Although this was only a problem on the DIP 20 IC holder dispenser, it could cause problems on the other holder dispensers as well. This issue should be monitored and when possible be solved preemptively. The sensor for all IC socket dispensers should be redesigned so that the sensor slots are flat, not slanted for 3D printing efficiency. Also, the sensors should be as low as possible, since there was no slot at the bottom of the IC sockets. This should be tested further to find an optimal position.

The MCU modules although operated as expected, lacked capacitors on the supply lines. This may help with stability issues seen on the bus at times and make the modules more reliable than they already are. It is suggested that the design be amended to add capacitors on the supply lines.

Due to the limitation in scope, only DIP packages were considered. If the Component Vending Machine project is to be successfully advanced, designs for other packages should be designed and implemented. This could also help students expand their knowledge by introducing uncommon components. By doing this, students would have the opportunity to use these rarely requested components they possibly never knew about. This is a possibility, due to the nature of the current White Lab component store being behind doors for the most part. The Component Vending Machines site would allow students to see what would be behind the door and explore a wider variety of components than those they have been told about in lectures.

The enclosure, although it served its' function, was not adequate to serve as the enclosure, permanently. The enclosure was not sturdy enough, due to the way the frame was designed, caused by an oversight and inaccuracies during the assembly process. One of the major problems, was the fact that the door sagged when open and needed to be propped up when closed. This is due to the weight of the door hanging on the frame and bending the frame, which caused it to sag on the open end. Either improvements need to be made, by strengthening the frame, or a pre-build enclosure should be bought to replace the current enclosure. A pre-bought enclosure was not considered for the purpose of this report due to the cost, that being far greater than making one out of raw materials, as was the one made for this report. This information about a pre-built frame was obtained in passing conversations with technical officers at UCT, which was why it never made its way into the report prior to the recommendations. Additionally the paint work done on the enclosure, although was adequate for the intended purpose, does not have a commercial finish. If a more professional finish were desired the paint work should be outsourced in order to give the Component Vending Machine a more professional look.

The ``daisy chain" method of connecting devices could cause strain on the cables currently used. This might occur in the form of overloading them with too much current and causing catastrophic failure. Furthermore, the resistance over the wires might become too great and cause unknown errors on the bus. To prevent this in the current form, thicker inner core transmission lines should be used as the system expands. A twisted shielded pair should be considered if more units were to be added to the chain. This would help reduce noise on the bus and make the communication more reliable. A twisted shielded pair was not used for the transmission lines as the communications worked without it in the current setup of the Component Vending Machine. An alternative would be to use DIN rails in a future implementation, which might make attaching each MCU module to the system easier and more efficient, while eliminating concerns that arose from using a ``daisy chain" method.

When programming the STM MCU modules, the programmer should take note of the instructions in \fullref{subsec:progamming}. This appendix serves as a guide for the current software. The guide in \fullref{subsec:maintenace} provides instructions for restocking and for maintenance of the Component Vending Machine. If new information is gained or the software changes, the corresponding guide should be updated to reflect the changes. All the software developed for this project has been included on the CD accompanying this report. Additionally, included on the CD also are the 3D models, circuit schematics and boards.

The Colour of the PLA 3D printed material affected the sensor readings. The black print seemed to work the best, as it would not reflect infrared light for the sensor, whereas the white print increased the sampled values because of the reflection. This should be taken into account for future delivery mechanism, as it would affect the sampling code. Either black PLA should be used consistently, or if a different colour is used, then calibration on the sampling code should be done.

The RFID reader proved unreliable due to its close proximity to the aluminium. It was moved further away with a wood piece as a spacer, between the RFID cover and aluminium. The RFID cover should be redesigned, in order to resolve this issue in a presentable manner. This could be achieved by using 2mm acrylic glass for the front cover, instead of 3mm and a second 3mm sheet on the back. 

Finally, when considering future expansion of this project, it is strongly recommended that it be made open source. Having it open source makes it possible for a community to develop around the project, similar to the RepRap project \cite{reprap}. Doing so would greatly increase the success of the project, possibly bringing in highly skilled designers and engineers to contribute to the project. Asking other universities to collaborate would be a good idea as well, as this would benefit their students too. Making use of Github to distribute the resources would promote this open source idea. If the project gains more popularity, a shift to an Atmel based system should be considered, as it is more widely used in open source projects. With an Atmel based system, more people might be interested in the project as it is a widely used system. Due to the success of the first assembly of the first White Lab Component Vending Machine, this project should definitely continue. All the resources in this project can be found on the Github repository at \cite{github} and on the CD that accompanied this report.
\newpage


\bibliographystyle{IEEEtran}
\bibliography{IEEEabrv,References}
\newpage

\begin{appendices}
\begin{landscape}
\section{Research Mind Map}\thispagestyle{sectionstart}
	\label{sec:resmm}
	\begin{center}
	\includegraphics[scale=0.22]{{RMM}.jpg}
	\end{center}
\end{landscape}
\section{Detailed Drawings}\thispagestyle{sectionstart}
	
	\subsection{IC Guide DIP Components}
	\label{subsec:g1}
	\begin{center}
	\includegraphics[scale=0.9]{{guidedet}.jpg}
	\end{center}	
	\newpage
	
	\subsection{IC Guide DIP Holder}
	\label{subsec:g2}
	\begin{center}
	\includegraphics[scale=0.9]{{guideholddet}.jpg}
	\end{center}
	\newpage
	
	\subsection{Vertical Roller \& Housing Version 1 \& 2}
	\label{subsec:v1}
	\begin{center}
	\includegraphics[scale=0.9]{{comparison1}.jpg}
	\end{center}
	\newpage
	
	\subsection{Horizontal Roller \& Housing Version 1}
	\label{subsec:h1}
	\begin{center}
	\includegraphics[scale=0.8]{{ideah1v2}.jpg}
	\end{center}
	\newpage
		
	\subsection{Horizontal Roller \& Housing Final Version}
	\label{subsec:h3}
	\begin{center}
	\includegraphics[scale=8]{{horfinalallv2}.jpg}
	\end{center}
	
	\subsection{Horizontal Roller Final Version}
	\label{subsec:h4}
	\begin{center}
	\includegraphics[scale=8]{{ALLROLLERSv2}.jpg}
	\end{center}
	\newpage
	
	\subsection{RFID Coil Cover}
	\label{subsec:rfid}
	\begin{center}
	\includegraphics[scale=7.5]{{RFIDdetailedv2}.jpg}
	\end{center}
	\newpage
\begin{landscape}
\section{PCB Diagrams}\thispagestyle{sectionstart}
\subsection{PI HAT Diagram}
\label{subsec:pihat}
	
	\begin{center}
	\includegraphics[scale=1]{{pihat}.png}
	\end{center}

\subsection{MCU Module Diagram}
\label{subsec:mcu}

	\begin{center}
	\includegraphics[scale=0.86]{{MCUmod}.png}
	\end{center}

\subsection{LCD Breakout Diagram}
\label{subsec:lcd}
	
	\begin{center}
	\includegraphics[scale=1]{{LCDBOARD}.png}
	\end{center}	
\end{landscape}
\section{Material Request Forms}\thispagestyle{sectionstart}
\label{sec:request}

	\begin{center}
	\includegraphics[scale=7]{{sheet1v3}.jpg}
	\includegraphics[scale=8]{{sheet2v3}.jpg}
	\includegraphics[scale=8]{{sheet3v3}.jpg}
	\includegraphics[scale=8]{{sheet4v2}.jpg}
	\includegraphics[scale=8]{{sheet5v2}.jpg}
	\includegraphics[scale=8]{{sheet6v2}.jpg}
	\includegraphics[scale=8]{{sheet7v2}.jpg}	
	\end{center}
\newpage
\section{Website}\thispagestyle{sectionstart}
\subsection{Components Store Page}
\label{subsec:weborders}
	\begin{changemargin}{-2cm}{-2cm}
	\begin{center}
	\includegraphics[scale=0.49]{{webordersupv2}.jpg}
	\end{center}
	\end{changemargin}	
	
	\begin{changemargin}{-1cm}{-1cm}
	\begin{center}
	\includegraphics[scale=0.49]{{webordersdownv2}.jpg}
	\end{center}
	\end{changemargin}	
	
\subsection{Contacts Page}
\label{subsec:contact}
	\begin{changemargin}{-1cm}{-1cm}
	\begin{center}
	\includegraphics[scale=0.5]{{webcontactv2}.jpg}
	\end{center}
	\end{changemargin}

\newpage
\section{Templates \& Drawings for Assembly}\thispagestyle{sectionstart}
\label{subsec:templates}
\subsection{DIP 8 Template}
	\begin{changemargin}{-1cm}{-1cm}
	\begin{center}
	\includegraphics[scale=7.4]{{DIP8TEMPv2}.jpg}
	\end{center}
	\end{changemargin}	
	

\subsection{DIP 14 or 16 Template}
	\begin{changemargin}{-1cm}{-1cm}
	\begin{center}	
	\includegraphics[scale=7.4]{{DIP1416TEMPv2}.jpg}
	\end{center}
	\end{changemargin}
	
\subsection{DIP 20 Template}
	\begin{changemargin}{-1cm}{-1cm}
	\begin{center}
	\includegraphics[scale=7.4]{{DIP20TEMPv2}.jpg}
	\end{center}
	\end{changemargin}
\subsection{Drill Template}
	\label{subsec:drilltemp}
	\begin{changemargin}{-1cm}{-1cm}
	\begin{center}
	\includegraphics[scale=1]{{drilltemplate}.jpg}
	\end{center}
	\end{changemargin}
\newpage

\subsection{Exploded Enclosure View}
\label{subsec:enctemplates}

	\begin{center}
	\includegraphics[scale=5.35]{{explodedenclosure}.jpg}
	\end{center}

\newpage
\section{Master Program Log}\thispagestyle{sectionstart}
\label{sec:maslog}
\lstset{
	escapeinside={\%*}{*)}
}
\begin{lstlisting}
11-11 18:50 root         DEBUG    =========================
11-11 18:50 root         DEBUG    Program Started
11-11 18:50 root         DEBUG    Reading card...
11-11 18:50 root         DEBUG    Flushing extra reads...
11-11 18:50 root         DEBUG    Done!
11-11 18:50 root         DEBUG    searching db
11-11 18:50 root         DEBUG    freeing up ics
11-11 18:50 root         DEBUG    Flushing extra reads...
11-11 18:50 root         DEBUG    Done!
11-11 18:50 root         DEBUG    display failed Failed
11-11 18:50 root         DEBUG    retrying LCD
11-11 18:50 root         DEBUG    Displayed Successfully
11-11 18:50 root         DEBUG    free
11-11 18:50 root         DEBUG    requesting
11-11 18:50 root         DEBUG    retrying LCD
11-11 18:50 root         DEBUG    Displayed Successfully
11-11 18:50 root         DEBUG    Dispencing
11-11 18:51 root         DEBUG    dispense failed, retrying
11-11 18:51 root         DEBUG    Dispensed Successfully
11-11 18:51 root         DEBUG    Finished Dispensing
11-11 18:51 root         DEBUG    Displayed Successfully
				  %*\textbf{Demo Log Starts here}*)
11-11 18:53 root         DEBUG    =========================
11-11 18:53 root         DEBUG    Program Started
11-11 18:55 root         DEBUG    Reading card...
11-11 18:55 root         DEBUG    Flushing extra reads...
11-11 18:55 root         DEBUG    Done!
11-11 18:55 root         DEBUG    searching db
11-11 18:55 root         DEBUG    requesting
11-11 18:55 root         DEBUG    Flushing extra reads...
11-11 18:55 root         DEBUG    Done!
11-11 18:55 root         DEBUG    display failed Failed
11-11 18:55 root         DEBUG    retrying LCD
11-11 18:55 root         DEBUG    Displayed Successfully
11-11 18:55 root         DEBUG    Dispencing
11-11 18:56 root         DEBUG    dispense failed, retrying
11-11 18:56 root         DEBUG    Dispensed Successfully
11-11 18:56 root         DEBUG    Dispencing
11-11 18:56 root         DEBUG    Dispensed Successfully
11-11 18:56 root         DEBUG    Dispencing
11-11 18:56 root         DEBUG    Dispensed Successfully
11-11 18:56 root         DEBUG    Dispencing
11-11 18:56 root         DEBUG    Dispensed Successfully
11-11 18:56 root         DEBUG    Dispencing
11-11 18:56 root         DEBUG    dispense failed, retrying
11-11 18:56 root         DEBUG    dispense failed, retrying
11-11 18:56 root         DEBUG    dispense failed, retrying
11-11 18:56 root         DEBUG    Dispensed Successfully
11-11 18:56 root         DEBUG    Finished Dispensing
11-11 18:56 root         DEBUG    Displayed Successfully

\end{lstlisting}

\newpage
\section{Manuals and Guides}\thispagestyle{sectionstart}

\subsection{Programming Guide}
\label{subsec:progamming}
This instruction set is to help program the microcontroller for the delivery mechanism that it required, it is presented in list form and should be performed in order. This list should be updated as the project progresses
\begin{enumerate}
  \item Before programming the STM make sure all the voltage levels on the terminals are correct and the PCB has been assembled correctly.
  \item Open EMBlocks.
  \item Open the MCU\_Module project.
  \item Open the main.c file under Sources/src in the menu on the left.
  \item At the top on line 19 you will find a definition of macros, uncomment ``\#define \_EXTRA\_" and ``\# define \_DEBUG\_".
  \item Uncomment the type of delivery mechanism being used. For example, if using the horizontal roller delivery mechanism uncomment ``\#define \_ROLLER\_".
  \item Plug in the STM32F051C6 to the computer.
  \item Upload the code to the MCU.
  \item Optional Calibration: {
  \begin{enumerate}
 
  \item Use an FTDI UART to USB convert or equivalent to connect the USART2 port to the computer for debug output.
  \item Take the terminal short off the ``Mode" terminal and put one on the terminal next to the potentiometer.
  \item Use the Calibration potentiometer to calibrate and update the values for dispensary actions. 
  \item Play with this action to see what values change to learn what the action does. It is fairly self-explanatory once observed.
  \item For the roller dispensary mechanism the first calibration will be the release value. Once the right value has been obtained through the serial monitor and aligning the bucket with the hole in the housing structure, go to definitions.h under Headers/src and go to line 30 and enter the new value for ``releasevalINIT".
  \item After 30s calibration for the pickup value will begin.
  \item Record the value on the serial monitor and enter it as the new value for ``pickupINIT" in definitions.h on line 31.
  \item It will change between release and pickup calibration every 15s so if either is missed the first time, just wait for it to go back.
  \item Place terminal short back on ``Mode" terminal and remove the short on the terminal next to the potentiometer in this order.
  \end{enumerate}}
  \item Test the dispensary action with the 8th address switch on the DIP switch.
  \item Plug into the RS485 bus and do a test dispense from the master.
\end{enumerate}

\subsection{Restocking and Maintenance Guide}
\label{subsec:maintenace}
\textbf{Restocking:}
\begin{enumerate}
\item Open the Component Vending Machine's door.
\item Take out a shelf or two to get to the shelf needing to be restocked.
\item Tilt the shelf to be restocked 90\degree towards yourself.
\item Slide the empty rail out of the guide.
\item Take a new rail and unplug one of the ends.
\item Slide the new rail into the guide and tilt the shelf back to its original position.
\end{enumerate}
\textbf{administrator settings:}

The administrator settings can be found in the websites files and in the Master program. This is located on the Raspberry Pi as follows:
\begin{lstlisting}
sudo nano /var/www/html/includes/variables.php
\end{lstlisting}
In this file you will see the following:
\begin{lstlisting}
<?php
$EmailAdmin = "bmorgan.noodles@gmail.com";
$partlimit = 3;
$complimit = 6;
?>
\end{lstlisting}
Change EmailAdmin to change the contact email address for the administrator. Change partlimit in order to change the number of non unique components that can be ordered. Change complimit to change the number of components in total that can be ordered.

Additionally, a limit in the Master program is applied to insure the maximum limit of total components is not exceeded by one student on any one day. This is on line \textbf{80 of the Master program}; VMMaster.py as \textbf{``complimit"}.

Lastly, The administrator list on the Master program is on \textbf{line 83} in an array called \textbf{``admins"}. Add or remove administrators through this list. They will have the ability to free up modules from an empty or jammed status.


\textbf{Assemble and Add New Modules:}
\begin{enumerate}
\item Assemble the Delivery mechanism:
\item \begin{enumerate}
		\item Get the corresponding design cut using one of the templates in \fullref{subsec:templates}.
		\item 3D print the IC guide; \fullref{subsec:g1} or \fullref{subsec:g2}, and a roller; \fullref{subsec:h4}.
		\item Assemble as per \autoref{subsec:deliveryassembly} on page no. \pageref{subsec:deliveryassembly}.
		\item When connecting the gap sensor sockets use the test board referenced in \autoref{fig:tester}.
		\item detailed pictures of the delivery mechanism has been provided in \fullref{subsec:h3}
		\end{enumerate}
\item Assemble the MCU Module:
\item \begin{enumerate}
		\item Order the PCB through a well known manufacturer.
		\item Assemble as per \autoref{subsubsec:mcuassemble} on page \pageref{subsubsec:mcuassemble} using the diagram \fullref{subsec:mcu} on page \pageref{subsec:mcu}.
		\end{enumerate}
\item Cut out a plate of wood as per the rectangular template \fullref{subsec:drilltemp} on page \pageref{subsec:drilltemp}.
\item Drill holes in this plate that line up with the holes on the MCU module.
\item Attache the MCU module using 3 10mm metal standoffs.
\item Take the shelf that the new module will be added too.
\item Drill holes on the shelf, make sure there are 2 extra sets of holes on the shelve. This is to ensure the template can be used to make more holes for more modules without removing already in place modules.
\item Attach the new module using bolts and nuts to hold it in place.
\item Attach the wooden plate with the MCU module on it.
\item Connect the sensors and motor to the corresponding headers, use the other existing modules as a template.
\end{enumerate}

\newpage

\lstset{numbers=left,
breaklines=true,
backgroundcolor=\color{white},
numbersep=25pt,
xleftmargin=1in,
xrightmargin=1in,
belowskip=0em}

\section{Terminal Commands}\thispagestyle{sectionstart}
\label{sec:PiCommands}

This Appendix serves to present the commands used to create a functional LAMP server to run the website on a Linux based system. The commands are listed in the order they should be executed:

Update software repository:
\hyphenpenalty 9999
\exhyphenpenalty 9999
\begin{lstlisting}
sudo apt-get update
suod apt-get upgrade
\end{lstlisting}
Install Apache web server:
\begin{lstlisting}[firstnumber=3]
sudo apt-get install apache2 -y
\end{lstlisting}
Type in IP address of Pi into the browser to test the Apache server. An Apache information page should appear on the screen. If successful, install PHP compiler and Apache plugin:
\begin{lstlisting}[firstnumber=4]
sudo apt-get install php5 libapache2-mod-php5 -y
\end{lstlisting}
Test the PHP compiler and plugin:
\begin{lstlisting}[firstnumber=5]
sudo nano index.php
<?php echo ``hello world"; ?>
\end{lstlisting}
Press Ctrl + X then Y then Enter to save the new file.
\begin{lstlisting}[firstnumber=7]
sudo rm index.html
sudo service apache2 restart
\end{lstlisting}
Wait for the Apache instance to restart. Type in the IP address of Pi into browser to test the PHP plugin. One should see plain text saying ``hello world". Next the MySQL database manager \& PHP plugin for MySQL must be installed and the Apache instance must be restarted. While installing the MySQL database manager, the installer will prompt the user for input, follow the instructions on screen:p
\begin{lstlisting}[firstnumber=9]
sudo apt-get install mysql-server php5-mysql -y
sudo service apache2 restart
\end{lstlisting}
Create a database with the name UCTVendingMachine with two tables; Orders and Components with columns specified in the commands below:
\begin{lstlisting}[firstnumber=11]
mysql-uroot -prootpoassword
CREATE DATABASE UCTVendingMachine;
use UCTVendingMachine;
CREATE TABLE Orders (StudentNo TINYTEXT NOT NULL, PartName TINYTEXT NOT NULL, Quantity TINYINT UNSIGNED NOT NULL, Date DATE NOT NULL, Done TINYINT UNSIGNED NOT NULL, ID INT UNSIGNED NOT NULL);
CREATE TABLE Components (Address TINYINT UNSIGNED NOT NULL, PartName TINYTEXT NOT NULL, Jam TINYINT UNSIGNED NOT NULL, Empty TINYINT UNSIGNED NOT NULL, Low TINYINT UNSIGNED NOT NULL);
\end{lstlisting}
Press CTRL+C to exit the MySQL shell. Download the Github repository containing the code needed to run the website and redirect the Apache web server to the new HomePage:
\begin{lstlisting}[firstnumber=16]
cd /var/www/
sudo rm -r html
sudo git clone https://github.com/BadenMorgan/VMWebsite.git html
sudo nano /etc/apache2/apache2.conf
\end{lstlisting}
Add the following to the end of this configuration file:
\begin{lstlisting}[firstnumber=20]
<IfModule mod_dir.c>
DirectoryIndex HomePage.php
</IfModule>
\end{lstlisting}
CTRL+X then Y and Enter to save and exit. Go to the IP in your browser and play around with the website, try to test if it inputs into the databases. To install the mail server to enable administrator notifications via email the following is done:
\begin{lstlisting}[firstnumber=23]
sudo apt-get install exim4
sudo dpkg-reconfigure exim4-config
\end{lstlisting}
Follow the on screen instructions. First select ``mail sent by smarthost; received via SMTP or fetchmail". Leave system mail name as ``raspberrypi". Leave IP as ``127.0.0.1 ; ::1". Leave the next field at ``raspberrypi" and the next blank. For outgoing smarthost, type ``smtp.gmail.com:587". Hide local mail name: no. Keep number of DNS: no. Delivery method: ``Maildir format in home directory". Split configuration files: no. Root and postmaster mail recipient: ``pi". Now update the email credentials:
\begin{lstlisting}[firstnumber=25]
sudo nano /etc/exim4/passwd.client
\end{lstlisting}
Add the following to the end of the file with the correct email details, this serves as a template, for gmail accounts, and does not contain actual login details. Note that special characters should be avoided:
\begin{lstlisting}[firstnumber=26]
gmail-smtp.l.google.com:email@gmail.com:pass
*.google.com:email@gmail.com:pass
smtp.gmail.com:email@gmail.com:pass
\end{lstlisting}
Ctrl+x then Y and enter to save and exit. Send a test email on the contacts page of the website. Add the required python libraries and change the permissions for the python script:
\begin{lstlisting}[firstnumber=29]
sudo apt-get install python3-dev
sudo apt-get install freetds-dev
sudo pip3 install PyMySQL pymssql httplib2
sudo chmod 775 /var/www/html/VMMaster.py
\end{lstlisting}
Move the boot time script that will run the python script at start up and give it the proper permissions. Next configure the Systemd to run the boot time script. Reboot to test the script:
\begin{lstlisting}[firstnumber=33]
sudo mv /var/www/html/myscript.service /lib/systemd/system/myscript.service
sudo systemctl daemon-reload
sudo systemctl enable myscript.service
sudo reboot now
\end{lstlisting}
Check the status of the task and the python scripts log file:
\begin{lstlisting}[firstnumber=37]
sudo systemctl status myscript.service
tail /var/www/html/MasterLog.log
\end{lstlisting}

\newpage

\section{Ethics Forms}\thispagestyle{sectionstart}
	\begin{changemargin}{-1cm}{-1cm}
	\begin{center}
	\includegraphics[scale=9.3]{{Signatureform}.jpg}
	\end{center}
	\end{changemargin}		
\end{appendices}
	%the end
\end{document}
